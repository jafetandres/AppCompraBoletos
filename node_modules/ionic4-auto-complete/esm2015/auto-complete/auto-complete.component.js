var AutoCompleteComponent_1;
import * as tslib_1 from "tslib";
import { Component, Input, Output, EventEmitter, ViewChild, HostListener, ElementRef } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { from, Observable, Subject } from 'rxjs';
import { finalize } from 'rxjs/operators';
import { AutoCompleteOptions } from '../auto-complete-options.model';
import { AutoCompleteStyles } from '../auto-complete-styles.model';
let AutoCompleteComponent = AutoCompleteComponent_1 = class AutoCompleteComponent {
    /**
     * Create a new instance
     */
    constructor() {
        this.alwaysShowList = false;
        this.autoFocusSuggestion = true;
        this.enableBrowserAutoComplete = false;
        this.clearInvalidInput = true;
        this.disabled = false;
        this.exclude = [];
        this.frontIcon = false;
        this.hideListOnSelection = true;
        this.location = 'auto';
        this.maxResults = 8;
        this.maxSelected = null;
        this.multi = false;
        this.name = '';
        this.removeButtonClasses = '';
        this.removeButtonColor = 'primary';
        this.removeButtonIcon = 'close-circle';
        this.removeButtonSlot = 'end';
        this.removeDuplicateSuggestions = true;
        this.selectOnTabOut = true;
        this.styles = new AutoCompleteStyles;
        this.useIonInput = false;
        this.autocompleteOptions = new AutoCompleteOptions();
        this.onTouchedCallback = false;
        this.onChangeCallback = false;
        this.hasFocus = false;
        this.isLoading = false;
        this.focusedOption = -1;
        this.showSuggestions = false;
        this.showListChanged = false;
        this.autoBlur = new EventEmitter();
        this.autoFocus = new EventEmitter();
        this.blur = new EventEmitter();
        this.focus = new EventEmitter();
        this.ionAutoInput = new EventEmitter();
        this.itemsChange = new EventEmitter();
        this.itemsCleared = new EventEmitter();
        this.itemsHidden = new EventEmitter();
        this.itemRemoved = new EventEmitter();
        this.itemSelected = new EventEmitter();
        this.itemsShown = new EventEmitter();
        this.modelChange = new EventEmitter();
        this.keyword = '';
        this.suggestions = [];
        this.autocompleteOptions = new AutoCompleteOptions();
        this.defaultOpts = new AutoCompleteOptions();
        this.selected = [];
    }
    get model() {
        let model = this.selected;
        if (!this.multi && typeof this.selected.length !== 'undefined') {
            if (this.selected.length === 0) {
                model = null;
            }
            else {
                model = this.selected[0];
            }
        }
        return model;
    }
    set model(selected) {
        if (typeof selected !== 'undefined' && selected !== null) {
            this.selected = selected;
            this.keyword = this.getLabel(selected);
        }
    }
    set options(options) {
        this.autocompleteOptions = new AutoCompleteOptions();
        const keys = Object.keys(this.autocompleteOptions);
        const keysLength = keys.length;
        for (let i = 0; i < keysLength; i++) {
            const key = keys[i];
            if (typeof options[key] !== 'undefined') {
                this.autocompleteOptions[key] = options[key];
            }
        }
    }
    set eager(eager) {
        if (eager) {
            this.getItems(null, false);
        }
    }
    get showList() {
        return this.showSuggestions;
    }
    set showList(value) {
        if (typeof value === 'undefined') {
            return;
        }
        if (this.showSuggestions === value) {
            return;
        }
        this.showSuggestions = value === true;
        this.showListChanged = true;
    }
    /**
     *
     */
    ngAfterViewChecked() {
        if (this.showListChanged) {
            this.showListChanged = false;
            this.showSuggestions ? this.itemsShown.emit() : this.itemsHidden.emit();
        }
    }
    ngDoCheck() {
        if (!this.hasFocus) {
            if (this.clearInvalidInput && (this.selected === null || this.multi)) {
                if (this.keyword !== '') {
                    this.keyword = '';
                }
                if (this.inputElem && this.inputElem.nativeElement) {
                    if (this.inputElem.nativeElement.children && this.inputElem.nativeElement.children.length !== 0) {
                        if (this.inputElem.nativeElement.children[0].children && this.inputElem.nativeElement.children[0].children.length !== 0) {
                            if (this.inputElem.nativeElement.children[0].children[0].value) {
                                this.inputElem.nativeElement.children[0].children[0].value = '';
                            }
                        }
                    }
                }
                if (this.searchbarElem && this.searchbarElem.nativeElement) {
                    if (this.searchbarElem.nativeElement.children && this.searchbarElem.nativeElement.children.length !== 0) {
                        if (this.searchbarElem.nativeElement.children[0].children) {
                            if (this.searchbarElem.nativeElement.children[0].children.length !== 0) {
                                if (this.searchbarElem.nativeElement.children[0].children[0].value) {
                                    this.searchbarElem.nativeElement.children[0].children[0].value = '';
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    /**
     * Handle document click
     *
     * @param event
     *
     * @private
     */
    documentClickHandler(event) {
        if ((this.searchbarElem && this.searchbarElem.nativeElement && !this.searchbarElem.nativeElement.contains(event.target))
            ||
                (!this.inputElem && this.inputElem.nativeElement && this.inputElem.nativeElement.contains(event.target))) {
            this.hideItemList();
        }
    }
    /**
     * Get value from form
     *
     * @param selection
     *
     * @private
     */
    getFormValue(selection) {
        if (selection == null || typeof this.dataProvider === 'function') {
            return null;
        }
        let attr = this.dataProvider.formValueAttribute == null ?
            this.dataProvider.labelAttribute : this.dataProvider.formValueAttribute;
        if (typeof selection === 'object' && attr) {
            return selection[attr];
        }
        return selection;
    }
    /**
     * Get element's position on screen
     *
     * @param el
     *
     * @private
     */
    _getPosition(el) {
        let xPos = 0;
        let yPos = 0;
        while (el) {
            if (el.tagName === 'BODY') {
                const xScroll = el.scrollLeft || document.documentElement.scrollLeft;
                const yScroll = el.scrollTop || document.documentElement.scrollTop;
                xPos += (el.offsetLeft - xScroll + el.clientLeft);
                yPos += (el.offsetTop - yScroll + el.clientTop);
            }
            else {
                xPos += (el.offsetLeft - el.scrollLeft + el.clientLeft);
                yPos += (el.offsetTop - el.scrollTop + el.clientTop);
            }
            el = el.offsetParent;
        }
        return {
            x: xPos,
            y: yPos
        };
    }
    clickClear() {
        this.clearValue(true);
        this.itemsCleared.emit(true);
    }
    /**
     * Clear current input value
     *
     * @param hideItemList
     */
    clearValue(hideItemList = false) {
        this.keyword = '';
        this.selection = null;
        this.formValue = null;
        if (hideItemList) {
            this.hideItemList();
        }
        this.focusedOption = -1;
        return;
    }
    /**
     * Get items for auto-complete
     *
     * @param event
     * @param show
     */
    getItems(event, show) {
        this.isLoading = true;
        if (this.promise) {
            clearTimeout(this.promise);
        }
        this.promise = setTimeout(() => {
            if (event) {
                this.keyword = event.detail.target.value;
            }
            let result;
            if (this.showResultsFirst && this.keyword.trim() === '') {
                this.keyword = '';
            }
            if (typeof this.dataProvider === 'function') {
                result = this.dataProvider(this.keyword);
                this.setSuggestions(result, show);
                this.isLoading = false;
            }
            else {
                result = this.dataProvider.getResults(this.keyword);
                if (result instanceof Subject) {
                    result = result.asObservable();
                }
                else if (result instanceof Promise) {
                    result = from(result);
                }
                if (result instanceof Observable) {
                    result.pipe(finalize(() => {
                        this.isLoading = false;
                    })).subscribe((results) => {
                        this.setSuggestions(results, show);
                    }, (error) => console.error(error));
                }
                else {
                    this.setSuggestions(result, show);
                    this.isLoading = false;
                }
            }
            this.ionAutoInput.emit(this.keyword);
        }, this.autocompleteOptions.debounce);
    }
    /**
     * Get an item's label
     *
     * @param selection
     */
    getLabel(selection) {
        if (selection == null || typeof this.dataProvider === 'function') {
            return '';
        }
        let attr = this.dataProvider.formValueAttribute == null ?
            this.dataProvider.labelAttribute : this.dataProvider.formValueAttribute;
        let value = selection;
        if (this.dataProvider.getItemLabel) {
            value = this.dataProvider.getItemLabel(value);
        }
        if (!this.multi && typeof value !== 'undefined' && Object.prototype.toString.call(value) === '[object Array]') {
            if (value.length === 0) {
                return '';
            }
            else {
                value = value[0];
            }
        }
        if (typeof value === 'object' && attr) {
            return value[attr] || '';
        }
        return value || '';
    }
    /**
     * Get current selection
     */
    getSelection() {
        if (this.multi) {
            return this.selection;
        }
        else {
            return this.selected;
        }
    }
    /**
     * Get menu style
     */
    listStyles() {
        const listLocationStyles = this.listLocationStyles();
        return Object.assign({}, listLocationStyles, this.styles.list);
    }
    listLocationStyles() {
        let location = this.location;
        if (this.location === 'auto') {
            const elementY = this._getPosition(this.searchbarElem.nativeElement).y;
            const windowY = window.innerHeight;
            if (elementY > windowY - elementY) {
                location = 'top';
            }
            else {
                location = 'bottom';
            }
        }
        if (location === 'bottom') {
            return {};
        }
        else {
            return {
                'bottom': '37px'
            };
        }
    }
    /**
     * Get current input value
     */
    getValue() {
        return this.formValue;
    }
    /**
     * Handles tab key press.
     * If `selectOnTabOut` is `true`, will select currently focused item
     *
     * @param event
     */
    handleTabOut(event) {
        if (this.selectOnTabOut && this.suggestions.length !== 0) {
            if (this.focusedOption !== -1) {
                this.selectItem(this.suggestions[this.focusedOption]);
            }
            else {
                this.hideItemList();
            }
        }
        else {
            this.hideItemList();
        }
        this.onBlur(event);
    }
    /**
     * Handle tap
     *
     * @param event
     */
    handleTap(event) {
        if (this.showResultsFirst || this.keyword.length > 0) {
            this.getItems();
        }
    }
    /**
     * Handle tap when selecting an item
     *
     * @param $event
     * @param suggestion
     */
    handleSelectTap($event, suggestion) {
        if (typeof suggestion !== 'undefined') {
            this.selectItem(suggestion);
            if ($event.srcEvent) {
                if ($event.srcEvent.stopPropagation) {
                    $event.srcEvent.stopPropagation();
                }
                if ($event.srcEvent.preventDefault) {
                    $event.srcEvent.preventDefault();
                }
            }
            else if ($event.preventDefault) {
                $event.preventDefault();
            }
        }
        return false;
    }
    /**
     * Hide item list
     */
    hideItemList() {
        if (this.showSuggestions === false && this.alwaysShowList === false) {
            this.showListChanged = true;
        }
        this.showSuggestions = this.alwaysShowList;
        this.focusedOption = -1;
    }
    highlightItem(direction) {
        if (this.showSuggestions === false) {
            this.showItemList();
        }
        const max = this.suggestions.length - 1;
        if (direction < 0) {
            if (this.focusedOption === -1 || this.focusedOption === max) {
                this.focusedOption = 0;
            }
            else {
                this.focusedOption++;
            }
        }
        else if (direction > 0) {
            if (this.focusedOption === -1 || this.focusedOption === 0) {
                this.focusedOption = max;
            }
            else {
                this.focusedOption--;
            }
        }
    }
    /**
     * Fired when the input focused
     */
    onFocus(event) {
        this.hasFocus = true;
        this.getItems();
        event = this._reflectName(event);
        this.autoFocus.emit(event);
        this.focus.emit(event);
    }
    /**
     * Fired when the input focused
     */
    onBlur(event) {
        this.hasFocus = false;
        event = this._reflectName(event);
        this.autoBlur.emit(event);
        this.blur.emit(event);
    }
    _reflectName(event) {
        if (typeof event.srcElement.attributes['ng-reflect-name'] === 'object') {
            event.srcElement.name = event.srcElement.attributes['ng-reflect-name'].value;
        }
        return event;
    }
    /**
     * Register onChangeCallback
     *
     * @param fn
     */
    registerOnChange(fn) {
        this.onChangeCallback = fn;
    }
    /**
     * Register onTouchedCallback
     *
     * @param fn
     */
    registerOnTouched(fn) {
        this.onTouchedCallback = fn;
    }
    /**
     * Remove already selected suggestions
     *
     * @param suggestions
     */
    removeDuplicates(suggestions) {
        const selectedCount = this.selected ? this.selected.length : 0;
        const suggestionCount = suggestions.length;
        for (let i = 0; i < selectedCount; i++) {
            const selectedLabel = this.getLabel(this.selected[i]);
            for (let j = 0; j < suggestionCount; j++) {
                const suggestedLabel = this.getLabel(suggestions[j]);
                if (selectedLabel === suggestedLabel) {
                    suggestions.splice(j, 1);
                }
            }
        }
        return suggestions;
    }
    removeExcluded(suggestions) {
        const excludedCount = this.exclude.length;
        for (let i = 0; i < excludedCount; i++) {
            let excludeLabel = this.exclude[i];
            if (typeof excludeLabel === 'object') {
                excludeLabel = this.getLabel(excludeLabel);
            }
            const suggestionCount = suggestions.length;
            for (let j = 0; j < suggestionCount; j++) {
                const suggestedLabel = this.getLabel(suggestions[j]);
                if (excludeLabel === suggestedLabel) {
                    suggestions.splice(j, 1);
                    break;
                }
            }
        }
        return suggestions;
    }
    /**
     * Remove item from selected
     *
     * @param selection
     * @param notify?
     */
    removeItem(selection, notify) {
        const count = this.selected ? this.selected.length : 0;
        for (let i = 0; i < count; i++) {
            const item = this.selected[i];
            const selectedLabel = this.getLabel(selection);
            const itemLabel = this.getLabel(item);
            if (selectedLabel === itemLabel) {
                this.selected.splice(i, 1);
            }
        }
        notify = typeof notify === 'undefined' ? true : notify;
        if (notify) {
            this.itemRemoved.emit(selection);
            this.itemsChange.emit(this.selected);
        }
        this.modelChange.emit(this.selected);
    }
    /**
     * Select item from list
     *
     * @param selection
     **/
    selectItem(selection) {
        this.keyword = this.getLabel(selection);
        this.formValue = this.getFormValue(selection);
        this.hideItemList();
        this.updateModel(this.formValue);
        if (this.hideListOnSelection) {
            this.hideItemList();
        }
        if (this.multi) {
            if (this.maxSelected === null || this.selected.length <= this.maxSelected) {
                this.clearValue();
                this.selected.push(selection);
                this.itemsChange.emit(this.selected);
            }
            else {
                return;
            }
        }
        else {
            this.selection = selection;
            this.selected = [selection];
            this.itemsChange.emit(selection);
        }
        this.itemSelected.emit(selection);
        this.modelChange.emit(this.selected);
    }
    /**
     * Set focus of searchbar
     */
    setFocus() {
        if (this.useIonInput && this.inputElem) {
            this.inputElem.nativeElement.setFocus();
        }
        else if (this.searchbarElem) {
            this.searchbarElem.nativeElement.setFocus();
        }
    }
    /**
     * Set suggestions
     *
     * @param suggestions
     * @param show
     */
    setSuggestions(suggestions, show) {
        if (this.removeDuplicateSuggestions) {
            suggestions = this.removeDuplicates(suggestions);
            suggestions = this.removeExcluded(suggestions);
        }
        this.suggestions = suggestions;
        if (show || typeof show === 'undefined') {
            this.showItemList();
        }
        if (this.autoFocusSuggestion) {
            if (this.suggestions.length !== 0) {
                this.focusedOption = 0;
            }
        }
    }
    /**
     * Set current input value
     *
     * @param selection
     */
    setValue(selection) {
        this.formValue = this.getFormValue(selection);
        this.keyword = this.getLabel(selection);
        return;
    }
    /**
     * Show item list
     */
    showItemList() {
        if (this.showSuggestions === false) {
            this.showListChanged = true;
        }
        this.showSuggestions = true;
    }
    /**
     * Update the model
     */
    updateModel(enteredText) {
        if (enteredText !== this.formValue) {
            this.formValue = enteredText;
            if (!this.multi) {
                this.selected = null;
            }
        }
        if (this.onChangeCallback) {
            this.onChangeCallback(this.formValue);
        }
        this.modelChange.emit(this.selected);
    }
    /**
     * Write value
     *
     * @param value
     */
    writeValue(value) {
        if (value !== this.selection) {
            this.selection = value || null;
            this.formValue = this.getFormValue(this.selection);
            this.keyword = this.getLabel(this.selection);
        }
    }
};
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "alwaysShowList", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "autoFocusSuggestion", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "enableBrowserAutoComplete", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "clearInvalidInput", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "dataProvider", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "disabled", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "emptyTemplate", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "exclude", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "frontIcon", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "hideListOnSelection", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "keyword", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "location", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "maxResults", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "maxSelected", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "multi", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "name", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "removeButtonClasses", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "removeButtonColor", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "removeButtonIcon", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "removeButtonSlot", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "removeDuplicateSuggestions", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "selectionTemplate", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "selectOnTabOut", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "showResultsFirst", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "styles", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "template", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "useIonInput", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "model", null);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "options", null);
tslib_1.__decorate([
    Output()
], AutoCompleteComponent.prototype, "modelChange", void 0);
tslib_1.__decorate([
    Input()
], AutoCompleteComponent.prototype, "eager", null);
tslib_1.__decorate([
    Output()
], AutoCompleteComponent.prototype, "blur", void 0);
tslib_1.__decorate([
    Output()
], AutoCompleteComponent.prototype, "autoFocus", void 0);
tslib_1.__decorate([
    Output()
], AutoCompleteComponent.prototype, "autoBlur", void 0);
tslib_1.__decorate([
    Output()
], AutoCompleteComponent.prototype, "focus", void 0);
tslib_1.__decorate([
    Output()
], AutoCompleteComponent.prototype, "ionAutoInput", void 0);
tslib_1.__decorate([
    Output()
], AutoCompleteComponent.prototype, "itemsChange", void 0);
tslib_1.__decorate([
    Output()
], AutoCompleteComponent.prototype, "itemsCleared", void 0);
tslib_1.__decorate([
    Output()
], AutoCompleteComponent.prototype, "itemsHidden", void 0);
tslib_1.__decorate([
    Output()
], AutoCompleteComponent.prototype, "itemRemoved", void 0);
tslib_1.__decorate([
    Output()
], AutoCompleteComponent.prototype, "itemSelected", void 0);
tslib_1.__decorate([
    Output()
], AutoCompleteComponent.prototype, "itemsShown", void 0);
tslib_1.__decorate([
    ViewChild('searchbarElem', {
        read: ElementRef,
        static: false
    })
], AutoCompleteComponent.prototype, "searchbarElem", void 0);
tslib_1.__decorate([
    ViewChild('inputElem', {
        read: ElementRef,
        static: false
    })
], AutoCompleteComponent.prototype, "inputElem", void 0);
tslib_1.__decorate([
    HostListener('document:click', ['$event'])
], AutoCompleteComponent.prototype, "documentClickHandler", null);
AutoCompleteComponent = AutoCompleteComponent_1 = tslib_1.__decorate([
    Component({
        providers: [
            {
                provide: NG_VALUE_ACCESSOR,
                useExisting: AutoCompleteComponent_1,
                multi: true
            }
        ],
        selector: 'ion-auto-complete',
        template: "<ng-template #defaultSelection\n             let-attrs=\"attrs\">\n    <ion-chip class=\"{{ attrs.removeButtonClasses }}\"\n              [color]=\"attrs.removeButtonColor\"\n              [outline]=\"true\">\n        <ion-icon *ngIf=\"frontIcon\"\n                  [name]=\"frontIcon\"\n                  [slot]=\"'start'\"\n                  color=\"primary\"></ion-icon>\n\n        <ion-label>{{ attrs.label }}</ion-label>\n\n        <ion-icon *ngIf=\"attrs.removeButtonIcon\"\n                  [name]=\"attrs.removeButtonIcon\"\n                  [slot]=\"attrs.removeButtonSlot\"></ion-icon>\n    </ion-chip>\n</ng-template>\n\n<div *ngIf=\"multi\">\n    <div *ngFor=\"let item of selected\"\n         class=\"selected-items\"\n         (click)=\"removeItem(item)\">\n        <ng-template [ngTemplateOutlet]=\"selectionTemplate || defaultSelection\"\n                     [ngTemplateOutletContext]=\"{\n                            attrs: {\n                              data:                item,\n                              label:               getLabel(item),\n                              removeButtonClasses: removeButtonClasses,\n                              removeButtonColor:   removeButtonColor,\n                              removeButtonIcon:    removeButtonIcon,\n                              removeButtonSlot:    removeButtonSlot\n                            }\n                         }\"></ng-template>\n    </div>\n</div>\n\n<ion-input #inputElem\n           [autocomplete]=\"enableBrowserAutoComplete ? 'on' : 'off'\"\n           [name]=\"name\"\n           (ionInput)=\"getItems($event)\"\n           (tap)=\"handleTap($event)\"\n           [(ngModel)]=\"keyword\"\n           (ngModelChange)=\"updateModel($event)\"\n           [placeholder]=\"autocompleteOptions.placeholder == null ? defaultOpts.placeholder : autocompleteOptions.placeholder\"\n           [type]=\"autocompleteOptions.type == null ? defaultOpts.type : autocompleteOptions.type\"\n           [clearOnEdit]=\"autocompleteOptions.clearOnEdit == null ? defaultOpts.clearOnEdit : autocompleteOptions.clearOnEdit\"\n           [clearInput]=\"autocompleteOptions.clearInput == null ? defaultOpts.clearInput : autocompleteOptions.clearInput\"\n           [color]=\"autocompleteOptions.color == null ? null : autocompleteOptions.color\"\n           [mode]=\"autocompleteOptions.mode == null ? defaultOpts.mode : autocompleteOptions.mode\"\n           [disabled]=\"disabled || (this.maxSelected !== null && this.selected.length >= this.maxSelected)\"\n           [ngClass]=\"{ 'hidden': !useIonInput, 'loading': isLoading }\"\n           [ngStyle]=\"styles.searchbar\"\n           (keydown.tab)=\"handleTabOut($event)\"\n           (keydown.shift.tab)=\"hideItemList()\"\n           (keyup.arrowDown)=\"highlightItem(-1)\"\n           (keyup.arrowUp)=\"highlightItem(1)\"\n           (keyup.enter)=\"handleSelectTap($event, suggestions[focusedOption])\"\n           (keyup.escape)=\"hideItemList()\"\n           (ionFocus)=\"onFocus($event)\"\n           (ionBlur)=\"onBlur($event)\"></ion-input>\n\n<ion-searchbar #searchbarElem\n               [autocomplete]=\"enableBrowserAutoComplete ? 'on' : 'off'\"\n               [name]=\"name\"\n               [animated]=\"autocompleteOptions.animated == null ? defaultOpts.animated : autocompleteOptions.animated\"\n               (ionInput)=\"getItems($event)\"\n               (tap)=\"handleTap($event)\"\n               [(ngModel)]=\"keyword\"\n               (ngModelChange)=\"updateModel($event)\"\n               [cancelButtonIcon]=\"autocompleteOptions.cancelButtonIcon == null ? defaultOpts.cancelButtonIcon : autocompleteOptions.cancelButtonIcon\"\n               [cancelButtonText]=\"autocompleteOptions.cancelButtonText == null ? defaultOpts.cancelButtonText : autocompleteOptions.cancelButtonText\"\n               [clearIcon]=\"autocompleteOptions.clearIcon == null ? defaultOpts.clearIcon : autocompleteOptions.clearIcon\"\n               [color]=\"autocompleteOptions.color == null ? null : autocompleteOptions.color\"\n               [showCancelButton]=\"autocompleteOptions.showCancelButton == null ?\n                                        (defaultOpts.showCancelButton ? 'always' : 'never') :\n                                        (autocompleteOptions.showCancelButton ? 'always' : 'never')\"\n               [debounce]=\"autocompleteOptions.debounce == null ? defaultOpts.debounce : autocompleteOptions.debounce\"\n               [placeholder]=\"autocompleteOptions.placeholder == null ? defaultOpts.placeholder : autocompleteOptions.placeholder\"\n               [autocorrect]=\"autocompleteOptions.autocorrect == null ? defaultOpts.autocorrect : autocompleteOptions.autocorrect\"\n               [mode]=\"autocompleteOptions.mode == null ? defaultOpts.mode : autocompleteOptions.mode\"\n               [searchIcon]=\"autocompleteOptions.searchIcon == null ? defaultOpts.searchIcon : autocompleteOptions.searchIcon\"\n               [spellcheck]=\"autocompleteOptions.spellcheck == null ? defaultOpts.spellcheck : autocompleteOptions.spellcheck\"\n               [type]=\"autocompleteOptions.type == null ? defaultOpts.type : autocompleteOptions.type\"\n               [ngClass]=\"{ 'hidden': useIonInput, 'loading': isLoading, 'disabled': disabled || (this.maxSelected !== null && this.selected.length >= this.maxSelected) }\"\n               [ngStyle]=\"styles.searchbar\"\n               (keydown.tab)=\"handleTabOut($event)\"\n               (keydown.shift.tab)=\"hideItemList()\"\n               (keyup.arrowDown)=\"highlightItem(-1)\"\n               (keyup.arrowUp)=\"highlightItem(1)\"\n               (keyup.enter)=\"handleSelectTap($event, suggestions[focusedOption])\"\n               (keyup.escape)=\"hideItemList()\"\n               (ionClear)=\"clickClear()\"\n               (ionFocus)=\"onFocus($event)\"\n               (ionBlur)=\"onBlur($event)\"></ion-searchbar>\n\n<ng-template #defaultTemplate\n             let-attrs=\"attrs\">\n    <span [innerHTML]='attrs.label | boldprefix:attrs.keyword'></span>\n</ng-template>\n\n<ng-template #defaultEmptyTemplate\n             let-attrs=\"attrs\"\n             class=\"ion-text-center\">\n    {{ autocompleteOptions.noItems }}\n</ng-template>\n\n<ul *ngIf=\"!(disabled || (this.maxSelected !== null && this.selected.length >= this.maxSelected)) && suggestions.length > 0 && showSuggestions\"\n    [ngStyle]=\"listStyles()\">\n    <li *ngFor=\"let suggestion of suggestions| slice:0:maxResults; let index = index\"\n        [ngClass]=\"{ 'focus': focusedOption === index }\"\n        [ngStyle]=\"styles.listItem\"\n        (mouseenter)=\"focusedOption = index\"\n        (click)=\"handleSelectTap($event, suggestion)\"\n        (tap)=\"handleSelectTap($event, suggestion)\">\n        <ng-template [ngTemplateOutlet]=\"template || defaultTemplate\"\n                     [ngTemplateOutletContext]=\"{\n                        attrs:{\n                          data:               suggestion,\n                          label:              getLabel(suggestion),\n                          keyword:            keyword,\n                          formValue:          getFormValue(suggestion),\n                          labelAttribute:     getLabel(suggestion),\n                          formValueAttribute: getFormValue(suggestion)\n                        }\n                     }\"></ng-template>\n    </li>\n</ul>\n\n<ul *ngIf=\"suggestions.length === 0 && showSuggestions\"\n    [ngStyle]=\"listStyles()\">\n    <li [ngStyle]=\"styles.listItem\">\n        <ng-template [ngTemplateOutlet]=\"emptyTemplate || defaultEmptyTemplate\"\n                     [ngTemplateOutletContext]=\"{\n                        attrs:{\n                          keyword: keyword\n                        }\n                     }\"></ng-template>\n    </li>\n</ul>\n",
        styles: ["ion-auto-complete{overflow:hidden!important;width:90vw;display:inline-block}ion-auto-complete ion-searchbar{padding:1px!important}ion-auto-complete .disabled input.searchbar-input{pointer-events:none;cursor:default}ion-auto-complete ul{position:absolute;width:90vw;margin-top:0;background:#fff;list-style-type:none;padding:0;left:16px;z-index:999;box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.2),0 1px 5px 0 rgba(0,0,0,.12)}ion-auto-complete ul li{padding:15px;border-bottom:1px solid #c1c1c1}ion-auto-complete ul ion-auto-complete-item{height:40px;width:100%}ion-auto-complete ul li:last-child{border:none}ion-auto-complete ul li.focus,ion-auto-complete ul li:focus{cursor:pointer;background:#f1f1f1}ion-auto-complete .hidden{display:none}ion-auto-complete .loading input.searchbar-input{background:url(/assets/loading.gif) right 4px center/25px 25px no-repeat #fff}ion-auto-complete .searchbar-clear-button.sc-ion-searchbar-md{right:34px}ion-auto-complete .selected-items{float:left}"]
    })
], AutoCompleteComponent);
export { AutoCompleteComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0by1jb21wbGV0ZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9pb25pYzQtYXV0by1jb21wbGV0ZS8iLCJzb3VyY2VzIjpbImF1dG8tY29tcGxldGUvYXV0by1jb21wbGV0ZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUVULEtBQUssRUFDTCxNQUFNLEVBQ04sWUFBWSxFQUVaLFNBQVMsRUFDVCxZQUFZLEVBQ1osVUFBVSxFQUVYLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBdUIsaUJBQWlCLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUV2RSxPQUFPLEVBQUMsSUFBSSxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUMsTUFBTSxNQUFNLENBQUM7QUFDL0MsT0FBTyxFQUFDLFFBQVEsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBRXhDLE9BQU8sRUFBQyxtQkFBbUIsRUFBQyxNQUFNLGdDQUFnQyxDQUFDO0FBRW5FLE9BQU8sRUFBQyxrQkFBa0IsRUFBQyxNQUFNLCtCQUErQixDQUFDO0FBZ0JqRSxJQUFhLHFCQUFxQiw2QkFBbEMsTUFBYSxxQkFBcUI7SUE2SWhDOztPQUVHO0lBQ0g7UUEvSWdCLG1CQUFjLEdBQVcsS0FBSyxDQUFDO1FBQy9CLHdCQUFtQixHQUFXLElBQUksQ0FBQztRQUNuQyw4QkFBeUIsR0FBVyxLQUFLLENBQUM7UUFDMUMsc0JBQWlCLEdBQVcsSUFBSSxDQUFDO1FBRWpDLGFBQVEsR0FBVyxLQUFLLENBQUM7UUFFekIsWUFBTyxHQUFTLEVBQUUsQ0FBQztRQUNuQixjQUFTLEdBQWdCLEtBQUssQ0FBQztRQUMvQix3QkFBbUIsR0FBVyxJQUFJLENBQUM7UUFFbkMsYUFBUSxHQUFVLE1BQU0sQ0FBQztRQUN6QixlQUFVLEdBQVUsQ0FBQyxDQUFDO1FBQ3RCLGdCQUFXLEdBQVUsSUFBSSxDQUFDO1FBQzFCLFVBQUssR0FBVyxLQUFLLENBQUM7UUFDdEIsU0FB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SUFBVCxNQUFNLEVBQUU7MERBQTRDO0FBR3JEO0lBREMsS0FBSyxFQUFFO2tEQUtQO0FBRVM7SUFBVCxNQUFNLEVBQUU7bURBQStCO0FBQzlCO0lBQVQsTUFBTSxFQUFFO3dEQUFvQztBQUNuQztJQUFULE1BQU0sRUFBRTt1REFBbUM7QUFDbEM7SUFBVCxNQUFNLEVBQUU7b0RBQWdDO0FBQy9CO0lBQVQsTUFBTSxFQUFFOzJEQUEwQztBQUN6QztJQUFULE1BQU0sRUFBRTswREFBc0M7QUFDckM7SUFBVCxNQUFNLEVBQUU7MkRBQTJDO0FBQzFDO0lBQVQsTUFBTSxFQUFFOzBEQUFzQztBQUNyQztJQUFULE1BQU0sRUFBRTswREFBc0M7QUFDckM7SUFBVCxNQUFNLEVBQUU7MkRBQXVDO0FBQ3RDO0lBQVQsTUFBTSxFQUFFO3lEQUFxQztBQVM5QztJQVBDLFNBQVMsQ0FDUixlQUFlLEVBQ2Y7UUFDRSxJQUFJLEVBQUksVUFBVTtRQUNsQixNQUFNLEVBQUUsS0FBSztLQUNkLENBQ0Y7NERBQ2dDO0FBU2pDO0lBUEMsU0FBUyxDQUNSLFdBQVcsRUFDWDtRQUNFLElBQUksRUFBSSxVQUFVO1FBQ2xCLE1BQU0sRUFBRSxLQUFLO0tBQ2QsQ0FDRjt3REFDNEI7QUFnSDdCO0lBREMsWUFBWSxDQUFDLGdCQUFnQixFQUFFLENBQUMsUUFBUSxDQUFDLENBQUM7aUVBUzFDO0FBbE9VLHFCQUFxQjtJQWRqQyxTQUFTLENBQUM7UUFDVCxTQUFTLEVBQUU7WUFDVDtnQkFDRSxPQUFPLEVBQUUsaUJBQWlCO2dCQUMxQixXQUFXLEVBQUUsdUJBQXFCO2dCQUNsQyxLQUFLLEVBQUUsSUFBSTthQUNaO1NBQ0Y7UUFDRCxRQUFRLEVBQUssbUJBQW1CO1FBSWhDLCtzUEFBMkM7O0tBQzVDLENBQUM7R0FDVyxxQkFBcUIsQ0EyeUJqQztTQTN5QlkscUJBQXFCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBEb0NoZWNrLFxuICBJbnB1dCxcbiAgT3V0cHV0LFxuICBFdmVudEVtaXR0ZXIsXG4gIFRlbXBsYXRlUmVmLFxuICBWaWV3Q2hpbGQsXG4gIEhvc3RMaXN0ZW5lcixcbiAgRWxlbWVudFJlZixcbiAgQWZ0ZXJWaWV3Q2hlY2tlZFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7Q29udHJvbFZhbHVlQWNjZXNzb3IsIE5HX1ZBTFVFX0FDQ0VTU09SfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5cbmltcG9ydCB7ZnJvbSwgT2JzZXJ2YWJsZSwgU3ViamVjdH0gZnJvbSAncnhqcyc7XG5pbXBvcnQge2ZpbmFsaXplfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7QXV0b0NvbXBsZXRlT3B0aW9uc30gZnJvbSAnLi4vYXV0by1jb21wbGV0ZS1vcHRpb25zLm1vZGVsJztcbmltcG9ydCB7QXV0b0NvbXBsZXRlU2VydmljZX0gZnJvbSAnLi4vYXV0by1jb21wbGV0ZS5zZXJ2aWNlJztcbmltcG9ydCB7QXV0b0NvbXBsZXRlU3R5bGVzfSBmcm9tICcuLi9hdXRvLWNvbXBsZXRlLXN0eWxlcy5tb2RlbCc7XG5cbkBDb21wb25lbnQoe1xuICBwcm92aWRlcnM6IFtcbiAgICB7XG4gICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgICAgIHVzZUV4aXN0aW5nOiBBdXRvQ29tcGxldGVDb21wb25lbnQsXG4gICAgICBtdWx0aTogdHJ1ZVxuICAgIH1cbiAgXSxcbiAgc2VsZWN0b3I6ICAgICdpb24tYXV0by1jb21wbGV0ZScsXG4gIHN0eWxlVXJsczogW1xuICAgICcuL2F1dG8tY29tcGxldGUuY29tcG9uZW50LnNjc3MnXG4gIF0sXG4gIHRlbXBsYXRlVXJsOiAnYXV0by1jb21wbGV0ZS5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgQXV0b0NvbXBsZXRlQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3Q2hlY2tlZCwgQ29udHJvbFZhbHVlQWNjZXNzb3IsIERvQ2hlY2sge1xuICBASW5wdXQoKSBwdWJsaWMgYWx3YXlzU2hvd0xpc3Q6Ym9vbGVhbiA9IGZhbHNlO1xuICBASW5wdXQoKSBwdWJsaWMgYXV0b0ZvY3VzU3VnZ2VzdGlvbjpib29sZWFuID0gdHJ1ZTtcbiAgQElucHV0KCkgcHVibGljIGVuYWJsZUJyb3dzZXJBdXRvQ29tcGxldGU6Ym9vbGVhbiA9IGZhbHNlO1xuICBASW5wdXQoKSBwdWJsaWMgY2xlYXJJbnZhbGlkSW5wdXQ6Ym9vbGVhbiA9IHRydWU7XG4gIEBJbnB1dCgpIHB1YmxpYyBkYXRhUHJvdmlkZXI6QXV0b0NvbXBsZXRlU2VydmljZXxGdW5jdGlvbjtcbiAgQElucHV0KCkgcHVibGljIGRpc2FibGVkOmJvb2xlYW4gPSBmYWxzZTtcbiAgQElucHV0KCkgcHVibGljIGVtcHR5VGVtcGxhdGU6VGVtcGxhdGVSZWY8YW55PjtcbiAgQElucHV0KCkgcHVibGljIGV4Y2x1ZGU6YW55W10gPSBbXTtcbiAgQElucHV0KCkgcHVibGljIGZyb250SWNvbjpmYWxzZXxzdHJpbmcgPSBmYWxzZTtcbiAgQElucHV0KCkgcHVibGljIGhpZGVMaXN0T25TZWxlY3Rpb246Ym9vbGVhbiA9IHRydWU7XG4gIEBJbnB1dCgpIHB1YmxpYyBrZXl3b3JkOnN0cmluZztcbiAgQElucHV0KCkgcHVibGljIGxvY2F0aW9uOnN0cmluZyA9ICdhdXRvJztcbiAgQElucHV0KCkgcHVibGljIG1heFJlc3VsdHM6bnVtYmVyID0gODtcbiAgQElucHV0KCkgcHVibGljIG1heFNlbGVjdGVkOm51bWJlciA9IG51bGw7XG4gIEBJbnB1dCgpIHB1YmxpYyBtdWx0aTpib29sZWFuID0gZmFsc2U7XG4gIEBJbnB1dCgpIHB1YmxpYyBuYW1lOnN0cmluZyA9ICcnO1xuICBASW5wdXQoKSBwdWJsaWMgcmVtb3ZlQnV0dG9uQ2xhc3NlczpzdHJpbmcgPSAnJztcbiAgQElucHV0KCkgcHVibGljIHJlbW92ZUJ1dHRvbkNvbG9yOnN0cmluZyA9ICdwcmltYXJ5JztcbiAgQElucHV0KCkgcHVibGljIHJlbW92ZUJ1dHRvbkljb246c3RyaW5nfGZhbHNlID0gJ2Nsb3NlLWNpcmNsZSc7XG4gIEBJbnB1dCgpIHB1YmxpYyByZW1vdmVCdXR0b25TbG90OnN0cmluZyA9ICdlbmQnO1xuICBASW5wdXQoKSBwdWJsaWMgcmVtb3ZlRHVwbGljYXRlU3VnZ2VzdGlvbnM6Ym9vbGVhbiA9IHRydWU7XG4gIEBJbnB1dCgpIHB1YmxpYyBzZWxlY3Rpb25UZW1wbGF0ZTpUZW1wbGF0ZVJlZjxhbnk+O1xuICBASW5wdXQoKSBwdWJsaWMgc2VsZWN0T25UYWJPdXQ6Ym9vbGVhbiA9IHRydWU7XG4gIEBJbnB1dCgpIHB1YmxpYyBzaG93UmVzdWx0c0ZpcnN0OmJvb2xlYW47XG4gIEBJbnB1dCgpIHB1YmxpYyBzdHlsZXMgPSBuZXcgQXV0b0NvbXBsZXRlU3R5bGVzO1xuICBASW5wdXQoKSBwdWJsaWMgdGVtcGxhdGU6VGVtcGxhdGVSZWY8YW55PjtcbiAgQElucHV0KCkgcHVibGljIHVzZUlvbklucHV0OmJvb2xlYW4gPSBmYWxzZTtcblxuICBASW5wdXQoKVxuICBnZXQgbW9kZWwoKTphbnl8YW55W10ge1xuICAgIGxldCBtb2RlbCA9IHRoaXMuc2VsZWN0ZWQ7XG4gICAgaWYgKCF0aGlzLm11bHRpICYmIHR5cGVvZiB0aGlzLnNlbGVjdGVkLmxlbmd0aCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIGlmICh0aGlzLnNlbGVjdGVkLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBtb2RlbCA9IG51bGw7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtb2RlbCA9IHRoaXMuc2VsZWN0ZWRbMF07XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG1vZGVsO1xuICB9XG5cbiAgc2V0IG1vZGVsKHNlbGVjdGVkOmFueXxhbnlbXSkge1xuICAgIGlmICh0eXBlb2Ygc2VsZWN0ZWQgIT09ICd1bmRlZmluZWQnICYmIHNlbGVjdGVkICE9PSBudWxsKSB7XG4gICAgICB0aGlzLnNlbGVjdGVkID0gc2VsZWN0ZWQ7XG5cbiAgICAgIHRoaXMua2V5d29yZCA9IHRoaXMuZ2V0TGFiZWwoc2VsZWN0ZWQpXG4gICAgfVxuICB9XG5cbiAgcHVibGljIGF1dG9jb21wbGV0ZU9wdGlvbnM6QXV0b0NvbXBsZXRlT3B0aW9ucyA9IG5ldyBBdXRvQ29tcGxldGVPcHRpb25zKCk7XG5cbiAgQElucHV0KClcbiAgc2V0IG9wdGlvbnMob3B0aW9uczpBdXRvQ29tcGxldGVPcHRpb25zfGFueSkge1xuICAgIHRoaXMuYXV0b2NvbXBsZXRlT3B0aW9ucyA9IG5ldyBBdXRvQ29tcGxldGVPcHRpb25zKCk7XG5cbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXModGhpcy5hdXRvY29tcGxldGVPcHRpb25zKTtcblxuICAgIGNvbnN0IGtleXNMZW5ndGggPSBrZXlzLmxlbmd0aDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXNMZW5ndGg7IGkrKykge1xuICAgICAgY29uc3Qga2V5ID0ga2V5c1tpXTtcblxuICAgICAgaWYgKHR5cGVvZiBvcHRpb25zW2tleV0gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHRoaXMuYXV0b2NvbXBsZXRlT3B0aW9uc1trZXldID0gb3B0aW9uc1trZXldO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIEBPdXRwdXQoKSBwdWJsaWMgbW9kZWxDaGFuZ2U6RXZlbnRFbWl0dGVyPGFueXxhbnlbXT47XG5cbiAgQElucHV0KClcbiAgc2V0IGVhZ2VyKGVhZ2VyOmJvb2xlYW4pIHtcbiAgICBpZiAoZWFnZXIpIHtcbiAgICAgIHRoaXMuZ2V0SXRlbXMobnVsbCwgZmFsc2UpO1xuICAgIH1cbiAgfVxuXG4gIEBPdXRwdXQoKSBwdWJsaWMgYmx1cjpFdmVudEVtaXR0ZXI8YW55PjtcbiAgQE91dHB1dCgpIHB1YmxpYyBhdXRvRm9jdXM6RXZlbnRFbWl0dGVyPGFueT47XG4gIEBPdXRwdXQoKSBwdWJsaWMgYXV0b0JsdXI6RXZlbnRFbWl0dGVyPGFueT47XG4gIEBPdXRwdXQoKSBwdWJsaWMgZm9jdXM6RXZlbnRFbWl0dGVyPGFueT47XG4gIEBPdXRwdXQoKSBwdWJsaWMgaW9uQXV0b0lucHV0OkV2ZW50RW1pdHRlcjxzdHJpbmc+O1xuICBAT3V0cHV0KCkgcHVibGljIGl0ZW1zQ2hhbmdlOkV2ZW50RW1pdHRlcjxhbnk+O1xuICBAT3V0cHV0KCkgcHVibGljIGl0ZW1zQ2xlYXJlZDpFdmVudEVtaXR0ZXI8Ym9vbGVhbj47XG4gIEBPdXRwdXQoKSBwdWJsaWMgaXRlbXNIaWRkZW46RXZlbnRFbWl0dGVyPGFueT47XG4gIEBPdXRwdXQoKSBwdWJsaWMgaXRlbVJlbW92ZWQ6RXZlbnRFbWl0dGVyPGFueT47XG4gIEBPdXRwdXQoKSBwdWJsaWMgaXRlbVNlbGVjdGVkOkV2ZW50RW1pdHRlcjxhbnk+O1xuICBAT3V0cHV0KCkgcHVibGljIGl0ZW1zU2hvd246RXZlbnRFbWl0dGVyPGFueT47XG5cbiAgQFZpZXdDaGlsZChcbiAgICAnc2VhcmNoYmFyRWxlbScsXG4gICAge1xuICAgICAgcmVhZDogICBFbGVtZW50UmVmLFxuICAgICAgc3RhdGljOiBmYWxzZVxuICAgIH1cbiAgKVxuICBwcml2YXRlIHNlYXJjaGJhckVsZW06RWxlbWVudFJlZjtcblxuICBAVmlld0NoaWxkKFxuICAgICdpbnB1dEVsZW0nLFxuICAgIHtcbiAgICAgIHJlYWQ6ICAgRWxlbWVudFJlZixcbiAgICAgIHN0YXRpYzogZmFsc2VcbiAgICB9XG4gIClcbiAgcHJpdmF0ZSBpbnB1dEVsZW06RWxlbWVudFJlZjtcblxuICBwcml2YXRlIG9uVG91Y2hlZENhbGxiYWNrOkZ1bmN0aW9ufGZhbHNlID0gZmFsc2U7XG4gIHByaXZhdGUgb25DaGFuZ2VDYWxsYmFjazpGdW5jdGlvbnxmYWxzZSA9IGZhbHNlO1xuXG4gIHB1YmxpYyBkZWZhdWx0T3B0czpBdXRvQ29tcGxldGVPcHRpb25zO1xuICBwdWJsaWMgaGFzRm9jdXM6Ym9vbGVhbiA9IGZhbHNlO1xuICBwdWJsaWMgaXNMb2FkaW5nOmJvb2xlYW4gPSBmYWxzZTtcbiAgcHVibGljIGZvY3VzZWRPcHRpb246bnVtYmVyID0gLTE7XG4gIHB1YmxpYyBmb3JtVmFsdWU6YW55O1xuICBwdWJsaWMgc2VsZWN0ZWQ6YW55fGFueVtdO1xuICBwdWJsaWMgc2VsZWN0aW9uOmFueTtcbiAgcHVibGljIHNob3dTdWdnZXN0aW9uczpib29sZWFuID0gZmFsc2U7XG4gIHB1YmxpYyBzdWdnZXN0aW9uczphbnlbXTtcbiAgcHVibGljIHByb21pc2U7XG5cbiAgcHVibGljIGdldCBzaG93TGlzdCgpOmJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnNob3dTdWdnZXN0aW9ucztcbiAgfVxuXG4gIHB1YmxpYyBzZXQgc2hvd0xpc3QodmFsdWU6Ym9vbGVhbikge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuc2hvd1N1Z2dlc3Rpb25zID09PSB2YWx1ZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuc2hvd1N1Z2dlc3Rpb25zID0gdmFsdWUgPT09IHRydWU7XG4gICAgdGhpcy5zaG93TGlzdENoYW5nZWQgPSB0cnVlO1xuICB9XG5cbiAgcHJpdmF0ZSBzaG93TGlzdENoYW5nZWQ6Ym9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBuZXcgaW5zdGFuY2VcbiAgICovXG4gIHB1YmxpYyBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmF1dG9CbHVyID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gICAgdGhpcy5hdXRvRm9jdXMgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgICB0aGlzLmJsdXIgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgICB0aGlzLmZvY3VzID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gICAgdGhpcy5pb25BdXRvSW5wdXQgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcbiAgICB0aGlzLml0ZW1zQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gICAgdGhpcy5pdGVtc0NsZWFyZWQgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XG4gICAgdGhpcy5pdGVtc0hpZGRlbiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICAgIHRoaXMuaXRlbVJlbW92ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgICB0aGlzLml0ZW1TZWxlY3RlZCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICAgIHRoaXMuaXRlbXNTaG93biA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICAgIHRoaXMubW9kZWxDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPGFueXxhbnlbXT4oKTtcblxuICAgIHRoaXMua2V5d29yZCA9ICcnO1xuICAgIHRoaXMuc3VnZ2VzdGlvbnMgPSBbXTtcblxuICAgIHRoaXMuYXV0b2NvbXBsZXRlT3B0aW9ucyA9IG5ldyBBdXRvQ29tcGxldGVPcHRpb25zKCk7XG5cbiAgICB0aGlzLmRlZmF1bHRPcHRzID0gbmV3IEF1dG9Db21wbGV0ZU9wdGlvbnMoKTtcblxuICAgIHRoaXMuc2VsZWN0ZWQgPSBbXTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgbmdBZnRlclZpZXdDaGVja2VkKCk6dm9pZCB7XG4gICAgaWYgKHRoaXMuc2hvd0xpc3RDaGFuZ2VkKSB7XG4gICAgICB0aGlzLnNob3dMaXN0Q2hhbmdlZCA9IGZhbHNlO1xuICAgICAgdGhpcy5zaG93U3VnZ2VzdGlvbnMgPyB0aGlzLml0ZW1zU2hvd24uZW1pdCgpIDogdGhpcy5pdGVtc0hpZGRlbi5lbWl0KCk7XG4gICAgfVxuICB9XG5cbiAgbmdEb0NoZWNrKCk6dm9pZCB7XG4gICAgaWYgKCF0aGlzLmhhc0ZvY3VzKSB7XG4gICAgICBpZiAodGhpcy5jbGVhckludmFsaWRJbnB1dCAmJiAodGhpcy5zZWxlY3RlZCA9PT0gbnVsbCB8fCB0aGlzLm11bHRpKSkge1xuICAgICAgICBpZiAodGhpcy5rZXl3b3JkICE9PSAnJykge1xuICAgICAgICAgIHRoaXMua2V5d29yZCA9ICcnO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaW5wdXRFbGVtICYmIHRoaXMuaW5wdXRFbGVtLm5hdGl2ZUVsZW1lbnQpIHtcbiAgICAgICAgICBpZiAodGhpcy5pbnB1dEVsZW0ubmF0aXZlRWxlbWVudC5jaGlsZHJlbiAmJiB0aGlzLmlucHV0RWxlbS5uYXRpdmVFbGVtZW50LmNoaWxkcmVuLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuaW5wdXRFbGVtLm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW5bMF0uY2hpbGRyZW4gJiYgdGhpcy5pbnB1dEVsZW0ubmF0aXZlRWxlbWVudC5jaGlsZHJlblswXS5jaGlsZHJlbi5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICAgICAgaWYgKHRoaXMuaW5wdXRFbGVtLm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW5bMF0uY2hpbGRyZW5bMF0udmFsdWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlucHV0RWxlbS5uYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdLmNoaWxkcmVuWzBdLnZhbHVlID0gJyc7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5zZWFyY2hiYXJFbGVtICYmIHRoaXMuc2VhcmNoYmFyRWxlbS5uYXRpdmVFbGVtZW50KSB7XG4gICAgICAgICAgaWYgKHRoaXMuc2VhcmNoYmFyRWxlbS5uYXRpdmVFbGVtZW50LmNoaWxkcmVuICYmIHRoaXMuc2VhcmNoYmFyRWxlbS5uYXRpdmVFbGVtZW50LmNoaWxkcmVuLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc2VhcmNoYmFyRWxlbS5uYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdLmNoaWxkcmVuKSB7XG4gICAgICAgICAgICAgIGlmICh0aGlzLnNlYXJjaGJhckVsZW0ubmF0aXZlRWxlbWVudC5jaGlsZHJlblswXS5jaGlsZHJlbi5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWFyY2hiYXJFbGVtLm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW5bMF0uY2hpbGRyZW5bMF0udmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoYmFyRWxlbS5uYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdLmNoaWxkcmVuWzBdLnZhbHVlID0gJyc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBkb2N1bWVudCBjbGlja1xuICAgKlxuICAgKiBAcGFyYW0gZXZlbnRcbiAgICpcbiAgICogQHByaXZhdGVcbiAgICovXG4gIEBIb3N0TGlzdGVuZXIoJ2RvY3VtZW50OmNsaWNrJywgWyckZXZlbnQnXSlcbiAgcHVibGljIGRvY3VtZW50Q2xpY2tIYW5kbGVyKGV2ZW50OkV2ZW50KTp2b2lkIHtcbiAgICBpZiAoXG4gICAgICAodGhpcy5zZWFyY2hiYXJFbGVtICYmIHRoaXMuc2VhcmNoYmFyRWxlbS5uYXRpdmVFbGVtZW50ICYmICF0aGlzLnNlYXJjaGJhckVsZW0ubmF0aXZlRWxlbWVudC5jb250YWlucyg8c3RyaW5nPjx1bmtub3duPmV2ZW50LnRhcmdldCkpXG4gICAgICB8fFxuICAgICAgKCF0aGlzLmlucHV0RWxlbSAmJiB0aGlzLmlucHV0RWxlbS5uYXRpdmVFbGVtZW50ICYmIHRoaXMuaW5wdXRFbGVtLm5hdGl2ZUVsZW1lbnQuY29udGFpbnMoPHN0cmluZz48dW5rbm93bj5ldmVudC50YXJnZXQpKVxuICAgICkge1xuICAgICAgdGhpcy5oaWRlSXRlbUxpc3QoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHZhbHVlIGZyb20gZm9ybVxuICAgKlxuICAgKiBAcGFyYW0gc2VsZWN0aW9uXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwdWJsaWMgZ2V0Rm9ybVZhbHVlKHNlbGVjdGlvbjphbnkpOmFueSB7XG4gICAgaWYgKHNlbGVjdGlvbiA9PSBudWxsIHx8IHR5cGVvZiB0aGlzLmRhdGFQcm92aWRlciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgbGV0IGF0dHIgPSB0aGlzLmRhdGFQcm92aWRlci5mb3JtVmFsdWVBdHRyaWJ1dGUgPT0gbnVsbCA/XG4gICAgICAgIHRoaXMuZGF0YVByb3ZpZGVyLmxhYmVsQXR0cmlidXRlIDogdGhpcy5kYXRhUHJvdmlkZXIuZm9ybVZhbHVlQXR0cmlidXRlO1xuXG4gICAgaWYgKHR5cGVvZiBzZWxlY3Rpb24gPT09ICdvYmplY3QnICYmIGF0dHIpIHtcbiAgICAgIHJldHVybiBzZWxlY3Rpb25bYXR0cl07XG4gICAgfVxuXG4gICAgcmV0dXJuIHNlbGVjdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgZWxlbWVudCdzIHBvc2l0aW9uIG9uIHNjcmVlblxuICAgKlxuICAgKiBAcGFyYW0gZWxcbiAgICpcbiAgICogQHByaXZhdGVcbiAgICovXG4gIHByaXZhdGUgX2dldFBvc2l0aW9uKGVsKTphbnkge1xuICAgIGxldCB4UG9zID0gMDtcbiAgICBsZXQgeVBvcyA9IDA7XG5cbiAgICB3aGlsZSAoZWwpIHtcbiAgICAgIGlmIChlbC50YWdOYW1lID09PSAnQk9EWScpIHtcbiAgICAgICAgY29uc3QgeFNjcm9sbCA9IGVsLnNjcm9sbExlZnQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnQ7XG4gICAgICAgIGNvbnN0IHlTY3JvbGwgPSBlbC5zY3JvbGxUb3AgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcDtcblxuICAgICAgICB4UG9zICs9IChlbC5vZmZzZXRMZWZ0IC0geFNjcm9sbCArIGVsLmNsaWVudExlZnQpO1xuICAgICAgICB5UG9zICs9IChlbC5vZmZzZXRUb3AgLSB5U2Nyb2xsICsgZWwuY2xpZW50VG9wKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHhQb3MgKz0gKGVsLm9mZnNldExlZnQgLSBlbC5zY3JvbGxMZWZ0ICsgZWwuY2xpZW50TGVmdCk7XG4gICAgICAgIHlQb3MgKz0gKGVsLm9mZnNldFRvcCAtIGVsLnNjcm9sbFRvcCArIGVsLmNsaWVudFRvcCk7XG4gICAgICB9XG5cbiAgICAgIGVsID0gZWwub2Zmc2V0UGFyZW50O1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgeDogeFBvcyxcbiAgICAgIHk6IHlQb3NcbiAgICB9O1xuICB9XG5cbiAgY2xpY2tDbGVhcigpOnZvaWQge1xuICAgIHRoaXMuY2xlYXJWYWx1ZSh0cnVlKTtcblxuICAgIHRoaXMuaXRlbXNDbGVhcmVkLmVtaXQodHJ1ZSk7XG4gIH1cblxuICAvKipcbiAgICogQ2xlYXIgY3VycmVudCBpbnB1dCB2YWx1ZVxuICAgKlxuICAgKiBAcGFyYW0gaGlkZUl0ZW1MaXN0XG4gICAqL1xuICBwdWJsaWMgY2xlYXJWYWx1ZShoaWRlSXRlbUxpc3Q6Ym9vbGVhbiA9IGZhbHNlKTp2b2lkIHtcbiAgICB0aGlzLmtleXdvcmQgPSAnJztcbiAgICB0aGlzLnNlbGVjdGlvbiA9IG51bGw7XG4gICAgdGhpcy5mb3JtVmFsdWUgPSBudWxsO1xuXG4gICAgaWYgKGhpZGVJdGVtTGlzdCkge1xuICAgICAgdGhpcy5oaWRlSXRlbUxpc3QoKTtcbiAgICB9XG5cbiAgICB0aGlzLmZvY3VzZWRPcHRpb24gPSAtMTtcblxuICAgIHJldHVybjtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgaXRlbXMgZm9yIGF1dG8tY29tcGxldGVcbiAgICpcbiAgICogQHBhcmFtIGV2ZW50XG4gICAqIEBwYXJhbSBzaG93XG4gICAqL1xuICBwdWJsaWMgZ2V0SXRlbXMoZXZlbnQ/LCBzaG93Pzpib29sZWFuKTp2b2lkIHtcbiAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7XG5cbiAgICBpZiAodGhpcy5wcm9taXNlKSB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5wcm9taXNlKTtcbiAgICB9XG5cbiAgICB0aGlzLnByb21pc2UgPSBzZXRUaW1lb3V0KFxuICAgICAgKCkgPT4ge1xuICAgICAgICBpZiAoZXZlbnQpIHtcbiAgICAgICAgICB0aGlzLmtleXdvcmQgPSBldmVudC5kZXRhaWwudGFyZ2V0LnZhbHVlO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHJlc3VsdDtcblxuICAgICAgICBpZiAodGhpcy5zaG93UmVzdWx0c0ZpcnN0ICYmIHRoaXMua2V5d29yZC50cmltKCkgPT09ICcnKSB7XG4gICAgICAgICAgdGhpcy5rZXl3b3JkID0gJyc7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIHRoaXMuZGF0YVByb3ZpZGVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgcmVzdWx0ID0gdGhpcy5kYXRhUHJvdmlkZXIodGhpcy5rZXl3b3JkKTtcblxuICAgICAgICAgIHRoaXMuc2V0U3VnZ2VzdGlvbnMocmVzdWx0LCBzaG93KTtcblxuICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzdWx0ID0gdGhpcy5kYXRhUHJvdmlkZXIuZ2V0UmVzdWx0cyh0aGlzLmtleXdvcmQpO1xuXG4gICAgICAgICAgaWYgKHJlc3VsdCBpbnN0YW5jZW9mIFN1YmplY3QpIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5hc09ic2VydmFibGUoKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdCBpbnN0YW5jZW9mIFByb21pc2UpIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IGZyb20ocmVzdWx0KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAocmVzdWx0IGluc3RhbmNlb2YgT2JzZXJ2YWJsZSkge1xuICAgICAgICAgICAgcmVzdWx0LnBpcGUoXG4gICAgICAgICAgICAgICAgZmluYWxpemUoXG4gICAgICAgICAgICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgKHJlc3VsdHM6IGFueVtdKSA9PiB7XG4gICAgICAgICAgICAgICAgICB0aGlzLnNldFN1Z2dlc3Rpb25zKHJlc3VsdHMsIHNob3cpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgKGVycm9yOiBhbnkpID0+IGNvbnNvbGUuZXJyb3IoZXJyb3IpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNldFN1Z2dlc3Rpb25zKHJlc3VsdCwgc2hvdyk7XG5cbiAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5pb25BdXRvSW5wdXQuZW1pdCh0aGlzLmtleXdvcmQpO1xuICAgICAgfSxcbiAgICAgIHRoaXMuYXV0b2NvbXBsZXRlT3B0aW9ucy5kZWJvdW5jZVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFuIGl0ZW0ncyBsYWJlbFxuICAgKlxuICAgKiBAcGFyYW0gc2VsZWN0aW9uXG4gICAqL1xuICBwdWJsaWMgZ2V0TGFiZWwoc2VsZWN0aW9uOmFueXxhbnlbXSk6c3RyaW5nIHtcbiAgICBpZiAoc2VsZWN0aW9uID09IG51bGwgfHwgdHlwZW9mIHRoaXMuZGF0YVByb3ZpZGVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXR1cm4gJyc7XG4gICAgfVxuXG4gICAgbGV0IGF0dHIgPSB0aGlzLmRhdGFQcm92aWRlci5mb3JtVmFsdWVBdHRyaWJ1dGUgPT0gbnVsbCA/XG4gICAgICAgIHRoaXMuZGF0YVByb3ZpZGVyLmxhYmVsQXR0cmlidXRlIDogdGhpcy5kYXRhUHJvdmlkZXIuZm9ybVZhbHVlQXR0cmlidXRlO1xuXG4gICAgbGV0IHZhbHVlID0gc2VsZWN0aW9uO1xuXG4gICAgaWYgKHRoaXMuZGF0YVByb3ZpZGVyLmdldEl0ZW1MYWJlbCkge1xuICAgICAgdmFsdWUgPSB0aGlzLmRhdGFQcm92aWRlci5nZXRJdGVtTGFiZWwodmFsdWUpO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5tdWx0aSAmJiB0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnICYmIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YWx1ZSkgPT09ICdbb2JqZWN0IEFycmF5XScpIHtcbiAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsdWUgPSB2YWx1ZVswXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiBhdHRyKSB7XG4gICAgICByZXR1cm4gdmFsdWVbYXR0cl0gfHwgJyc7XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlIHx8ICcnO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IHNlbGVjdGlvblxuICAgKi9cbiAgcHVibGljIGdldFNlbGVjdGlvbigpOmFueXxhbnlbXSB7XG4gICAgaWYgKHRoaXMubXVsdGkpIHtcbiAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWQ7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBtZW51IHN0eWxlXG4gICAqL1xuICBwdWJsaWMgbGlzdFN0eWxlcygpOmFueSB7XG4gICAgY29uc3QgbGlzdExvY2F0aW9uU3R5bGVzID0gdGhpcy5saXN0TG9jYXRpb25TdHlsZXMoKTtcbiAgICByZXR1cm4geyAuLi5saXN0TG9jYXRpb25TdHlsZXMsIC4uLnRoaXMuc3R5bGVzLmxpc3QgfTtcbiAgfVxuXG4gIHByaXZhdGUgbGlzdExvY2F0aW9uU3R5bGVzKCk6YW55IHtcbiAgICBsZXQgbG9jYXRpb24gPSB0aGlzLmxvY2F0aW9uO1xuXG4gICAgaWYgKHRoaXMubG9jYXRpb24gPT09ICdhdXRvJykge1xuICAgICAgY29uc3QgZWxlbWVudFkgPSB0aGlzLl9nZXRQb3NpdGlvbihcbiAgICAgICAgdGhpcy5zZWFyY2hiYXJFbGVtLm5hdGl2ZUVsZW1lbnRcbiAgICAgICkueTtcblxuICAgICAgY29uc3Qgd2luZG93WSA9IHdpbmRvdy5pbm5lckhlaWdodDtcblxuICAgICAgaWYgKGVsZW1lbnRZID4gd2luZG93WSAtIGVsZW1lbnRZKSB7XG4gICAgICAgIGxvY2F0aW9uID0gJ3RvcCc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2NhdGlvbiA9ICdib3R0b20nO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChsb2NhdGlvbiA9PT0gJ2JvdHRvbScpIHtcbiAgICAgIHJldHVybiB7fTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgJ2JvdHRvbSc6ICczN3B4J1xuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IGN1cnJlbnQgaW5wdXQgdmFsdWVcbiAgICovXG4gIHB1YmxpYyBnZXRWYWx1ZSgpOmFueSB7XG4gICAgcmV0dXJuIHRoaXMuZm9ybVZhbHVlO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZXMgdGFiIGtleSBwcmVzcy5cbiAgICogSWYgYHNlbGVjdE9uVGFiT3V0YCBpcyBgdHJ1ZWAsIHdpbGwgc2VsZWN0IGN1cnJlbnRseSBmb2N1c2VkIGl0ZW1cbiAgICogXG4gICAqIEBwYXJhbSBldmVudFxuICAgKi9cbiAgcHVibGljIGhhbmRsZVRhYk91dChldmVudCk6dm9pZCB7XG4gICAgaWYgKHRoaXMuc2VsZWN0T25UYWJPdXQgJiYgdGhpcy5zdWdnZXN0aW9ucy5sZW5ndGggIT09IDApIHtcbiAgICAgIGlmICh0aGlzLmZvY3VzZWRPcHRpb24gIT09IC0xKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0SXRlbSh0aGlzLnN1Z2dlc3Rpb25zW3RoaXMuZm9jdXNlZE9wdGlvbl0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5oaWRlSXRlbUxpc3QoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5oaWRlSXRlbUxpc3QoKTtcbiAgICB9XG5cbiAgICB0aGlzLm9uQmx1cihldmVudCk7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIHRhcFxuICAgKlxuICAgKiBAcGFyYW0gZXZlbnRcbiAgICovXG4gIHB1YmxpYyBoYW5kbGVUYXAoZXZlbnQpOnZvaWQge1xuICAgIGlmICh0aGlzLnNob3dSZXN1bHRzRmlyc3QgfHwgdGhpcy5rZXl3b3JkLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuZ2V0SXRlbXMoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIHRhcCB3aGVuIHNlbGVjdGluZyBhbiBpdGVtXG4gICAqXG4gICAqIEBwYXJhbSAkZXZlbnRcbiAgICogQHBhcmFtIHN1Z2dlc3Rpb25cbiAgICovXG4gIHB1YmxpYyBoYW5kbGVTZWxlY3RUYXAoJGV2ZW50LCBzdWdnZXN0aW9uPzphbnkpOmZhbHNlIHtcbiAgICBpZiAodHlwZW9mIHN1Z2dlc3Rpb24gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICB0aGlzLnNlbGVjdEl0ZW0oc3VnZ2VzdGlvbik7XG5cbiAgICAgIGlmICgkZXZlbnQuc3JjRXZlbnQpIHtcbiAgICAgICAgaWYgKCRldmVudC5zcmNFdmVudC5zdG9wUHJvcGFnYXRpb24pIHtcbiAgICAgICAgICAkZXZlbnQuc3JjRXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCRldmVudC5zcmNFdmVudC5wcmV2ZW50RGVmYXVsdCkge1xuICAgICAgICAgICRldmVudC5zcmNFdmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKCRldmVudC5wcmV2ZW50RGVmYXVsdCkge1xuICAgICAgICAkZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogSGlkZSBpdGVtIGxpc3RcbiAgICovXG4gIHB1YmxpYyBoaWRlSXRlbUxpc3QoKTp2b2lkIHtcbiAgICBpZiAodGhpcy5zaG93U3VnZ2VzdGlvbnMgPT09IGZhbHNlICYmIHRoaXMuYWx3YXlzU2hvd0xpc3QgPT09IGZhbHNlKSB7XG4gICAgICB0aGlzLnNob3dMaXN0Q2hhbmdlZCA9IHRydWU7XG4gICAgfVxuXG4gICAgdGhpcy5zaG93U3VnZ2VzdGlvbnMgPSB0aGlzLmFsd2F5c1Nob3dMaXN0O1xuICAgIHRoaXMuZm9jdXNlZE9wdGlvbiA9IC0xO1xuICB9XG5cbiAgaGlnaGxpZ2h0SXRlbShkaXJlY3Rpb246bnVtYmVyKTp2b2lkIHtcbiAgICBpZiAodGhpcy5zaG93U3VnZ2VzdGlvbnMgPT09IGZhbHNlKSB7XG4gICAgICB0aGlzLnNob3dJdGVtTGlzdCgpO1xuICAgIH1cblxuICAgIGNvbnN0IG1heCA9IHRoaXMuc3VnZ2VzdGlvbnMubGVuZ3RoIC0gMTtcblxuICAgIGlmIChkaXJlY3Rpb24gPCAwKSB7XG4gICAgICBpZiAodGhpcy5mb2N1c2VkT3B0aW9uID09PSAtMSB8fCB0aGlzLmZvY3VzZWRPcHRpb24gPT09IG1heCkge1xuICAgICAgICB0aGlzLmZvY3VzZWRPcHRpb24gPSAwO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5mb2N1c2VkT3B0aW9uKys7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPiAwKSB7XG4gICAgICBpZiAodGhpcy5mb2N1c2VkT3B0aW9uID09PSAtMSB8fCB0aGlzLmZvY3VzZWRPcHRpb24gPT09IDApIHtcbiAgICAgICAgdGhpcy5mb2N1c2VkT3B0aW9uID0gbWF4O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5mb2N1c2VkT3B0aW9uLS07XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEZpcmVkIHdoZW4gdGhlIGlucHV0IGZvY3VzZWRcbiAgICovXG4gIG9uRm9jdXMoZXZlbnQ6YW55KTp2b2lkIHtcbiAgICB0aGlzLmhhc0ZvY3VzID0gdHJ1ZTtcblxuICAgIHRoaXMuZ2V0SXRlbXMoKTtcblxuICAgIGV2ZW50ID0gdGhpcy5fcmVmbGVjdE5hbWUoZXZlbnQpO1xuXG4gICAgdGhpcy5hdXRvRm9jdXMuZW1pdChldmVudCk7XG4gICAgdGhpcy5mb2N1cy5lbWl0KGV2ZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaXJlZCB3aGVuIHRoZSBpbnB1dCBmb2N1c2VkXG4gICAqL1xuICBvbkJsdXIoZXZlbnQpOnZvaWQge1xuICAgIHRoaXMuaGFzRm9jdXMgPSBmYWxzZTtcblxuICAgIGV2ZW50ID0gdGhpcy5fcmVmbGVjdE5hbWUoZXZlbnQpO1xuXG4gICAgdGhpcy5hdXRvQmx1ci5lbWl0KGV2ZW50KTtcbiAgICB0aGlzLmJsdXIuZW1pdChldmVudCk7XG4gIH1cblxuICBfcmVmbGVjdE5hbWUoZXZlbnQ6YW55KTphbnkge1xuICAgIGlmICh0eXBlb2YgZXZlbnQuc3JjRWxlbWVudC5hdHRyaWJ1dGVzWyduZy1yZWZsZWN0LW5hbWUnXSA9PT0gJ29iamVjdCcpIHtcbiAgICAgIGV2ZW50LnNyY0VsZW1lbnQubmFtZSA9IGV2ZW50LnNyY0VsZW1lbnQuYXR0cmlidXRlc1snbmctcmVmbGVjdC1uYW1lJ10udmFsdWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGV2ZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIFJlZ2lzdGVyIG9uQ2hhbmdlQ2FsbGJhY2tcbiAgICpcbiAgICogQHBhcmFtIGZuXG4gICAqL1xuICBwdWJsaWMgcmVnaXN0ZXJPbkNoYW5nZShmbjpGdW5jdGlvbnxmYWxzZSk6dm9pZCB7XG4gICAgdGhpcy5vbkNoYW5nZUNhbGxiYWNrID0gZm47XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0ZXIgb25Ub3VjaGVkQ2FsbGJhY2tcbiAgICpcbiAgICogQHBhcmFtIGZuXG4gICAqL1xuICBwdWJsaWMgcmVnaXN0ZXJPblRvdWNoZWQoZm46RnVuY3Rpb258ZmFsc2UpOnZvaWQge1xuICAgIHRoaXMub25Ub3VjaGVkQ2FsbGJhY2sgPSBmbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgYWxyZWFkeSBzZWxlY3RlZCBzdWdnZXN0aW9uc1xuICAgKlxuICAgKiBAcGFyYW0gc3VnZ2VzdGlvbnNcbiAgICovXG4gIHB1YmxpYyByZW1vdmVEdXBsaWNhdGVzKHN1Z2dlc3Rpb25zOmFueVtdKTphbnlbXSB7XG4gICAgY29uc3Qgc2VsZWN0ZWRDb3VudCA9IHRoaXMuc2VsZWN0ZWQgPyB0aGlzLnNlbGVjdGVkLmxlbmd0aCA6IDA7XG5cbiAgICBjb25zdCBzdWdnZXN0aW9uQ291bnQgPSBzdWdnZXN0aW9ucy5sZW5ndGg7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNlbGVjdGVkQ291bnQ7IGkrKykge1xuICAgICAgY29uc3Qgc2VsZWN0ZWRMYWJlbCA9IHRoaXMuZ2V0TGFiZWwoXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRbaV1cbiAgICAgICk7XG5cbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgc3VnZ2VzdGlvbkNvdW50OyBqKyspIHtcbiAgICAgICAgY29uc3Qgc3VnZ2VzdGVkTGFiZWwgPSB0aGlzLmdldExhYmVsKFxuICAgICAgICAgIHN1Z2dlc3Rpb25zW2pdXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKHNlbGVjdGVkTGFiZWwgPT09IHN1Z2dlc3RlZExhYmVsKSB7XG4gICAgICAgICAgc3VnZ2VzdGlvbnMuc3BsaWNlKGosIDEpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHN1Z2dlc3Rpb25zO1xuICB9XG5cbiAgcHVibGljIHJlbW92ZUV4Y2x1ZGVkKHN1Z2dlc3Rpb25zOmFueVtdKTphbnlbXSB7XG4gICAgY29uc3QgZXhjbHVkZWRDb3VudCA9IHRoaXMuZXhjbHVkZS5sZW5ndGg7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGV4Y2x1ZGVkQ291bnQ7IGkrKykge1xuICAgICAgbGV0IGV4Y2x1ZGVMYWJlbCA9IHRoaXMuZXhjbHVkZVtpXTtcbiAgICAgIGlmICh0eXBlb2YgZXhjbHVkZUxhYmVsID09PSAnb2JqZWN0Jykge1xuICAgICAgICBleGNsdWRlTGFiZWwgPSB0aGlzLmdldExhYmVsKGV4Y2x1ZGVMYWJlbCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHN1Z2dlc3Rpb25Db3VudCA9IHN1Z2dlc3Rpb25zLmxlbmd0aDtcblxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzdWdnZXN0aW9uQ291bnQ7IGorKykge1xuICAgICAgICBjb25zdCBzdWdnZXN0ZWRMYWJlbCA9IHRoaXMuZ2V0TGFiZWwoXG4gICAgICAgICAgc3VnZ2VzdGlvbnNbal1cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAoZXhjbHVkZUxhYmVsID09PSBzdWdnZXN0ZWRMYWJlbCkge1xuICAgICAgICAgIHN1Z2dlc3Rpb25zLnNwbGljZShqLCAxKTtcblxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHN1Z2dlc3Rpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBpdGVtIGZyb20gc2VsZWN0ZWRcbiAgICpcbiAgICogQHBhcmFtIHNlbGVjdGlvblxuICAgKiBAcGFyYW0gbm90aWZ5P1xuICAgKi9cbiAgcHVibGljIHJlbW92ZUl0ZW0oc2VsZWN0aW9uOmFueSwgbm90aWZ5Pzpib29sZWFuKTp2b2lkIHtcbiAgICBjb25zdCBjb3VudCA9IHRoaXMuc2VsZWN0ZWQgPyB0aGlzLnNlbGVjdGVkLmxlbmd0aCA6IDA7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcbiAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLnNlbGVjdGVkW2ldO1xuXG4gICAgICBjb25zdCBzZWxlY3RlZExhYmVsID0gdGhpcy5nZXRMYWJlbChzZWxlY3Rpb24pO1xuICAgICAgY29uc3QgaXRlbUxhYmVsID0gdGhpcy5nZXRMYWJlbChpdGVtKTtcblxuICAgICAgaWYgKHNlbGVjdGVkTGFiZWwgPT09IGl0ZW1MYWJlbCkge1xuICAgICAgICB0aGlzLnNlbGVjdGVkLnNwbGljZShpLCAxKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBub3RpZnkgPSB0eXBlb2Ygbm90aWZ5ID09PSAndW5kZWZpbmVkJyA/IHRydWUgOiBub3RpZnk7XG5cbiAgICBpZiAobm90aWZ5KSB7XG4gICAgICAgIHRoaXMuaXRlbVJlbW92ZWQuZW1pdChzZWxlY3Rpb24pO1xuICAgICAgICB0aGlzLml0ZW1zQ2hhbmdlLmVtaXQodGhpcy5zZWxlY3RlZCk7XG4gICAgfVxuXG4gICAgdGhpcy5tb2RlbENoYW5nZS5lbWl0KHRoaXMuc2VsZWN0ZWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbGVjdCBpdGVtIGZyb20gbGlzdFxuICAgKlxuICAgKiBAcGFyYW0gc2VsZWN0aW9uXG4gICAqKi9cbiAgcHVibGljIHNlbGVjdEl0ZW0oc2VsZWN0aW9uOmFueSk6dm9pZCB7XG4gICAgdGhpcy5rZXl3b3JkID0gdGhpcy5nZXRMYWJlbChzZWxlY3Rpb24pO1xuICAgIHRoaXMuZm9ybVZhbHVlID0gdGhpcy5nZXRGb3JtVmFsdWUoc2VsZWN0aW9uKTtcbiAgICB0aGlzLmhpZGVJdGVtTGlzdCgpO1xuXG4gICAgdGhpcy51cGRhdGVNb2RlbCh0aGlzLmZvcm1WYWx1ZSk7XG5cbiAgICBpZiAodGhpcy5oaWRlTGlzdE9uU2VsZWN0aW9uKSB7XG4gICAgICB0aGlzLmhpZGVJdGVtTGlzdCgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLm11bHRpKSB7XG4gICAgICBpZiAodGhpcy5tYXhTZWxlY3RlZCA9PT0gbnVsbCB8fCB0aGlzLnNlbGVjdGVkLmxlbmd0aCA8PSB0aGlzLm1heFNlbGVjdGVkKSB7XG4gICAgICAgIHRoaXMuY2xlYXJWYWx1ZSgpO1xuXG4gICAgICAgIHRoaXMuc2VsZWN0ZWQucHVzaChzZWxlY3Rpb24pO1xuICAgICAgICB0aGlzLml0ZW1zQ2hhbmdlLmVtaXQodGhpcy5zZWxlY3RlZCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2VsZWN0aW9uID0gc2VsZWN0aW9uO1xuXG4gICAgICB0aGlzLnNlbGVjdGVkID0gW3NlbGVjdGlvbl07XG4gICAgICB0aGlzLml0ZW1zQ2hhbmdlLmVtaXQoc2VsZWN0aW9uKTtcbiAgICB9XG5cbiAgICB0aGlzLml0ZW1TZWxlY3RlZC5lbWl0KHNlbGVjdGlvbik7XG4gICAgdGhpcy5tb2RlbENoYW5nZS5lbWl0KHRoaXMuc2VsZWN0ZWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCBmb2N1cyBvZiBzZWFyY2hiYXJcbiAgICovXG4gIHB1YmxpYyBzZXRGb2N1cygpOnZvaWQge1xuICAgIGlmICh0aGlzLnVzZUlvbklucHV0ICYmIHRoaXMuaW5wdXRFbGVtKSB7XG4gICAgICB0aGlzLmlucHV0RWxlbS5uYXRpdmVFbGVtZW50LnNldEZvY3VzKCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLnNlYXJjaGJhckVsZW0pIHtcbiAgICAgIHRoaXMuc2VhcmNoYmFyRWxlbS5uYXRpdmVFbGVtZW50LnNldEZvY3VzKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldCBzdWdnZXN0aW9uc1xuICAgKlxuICAgKiBAcGFyYW0gc3VnZ2VzdGlvbnNcbiAgICogQHBhcmFtIHNob3dcbiAgICovXG4gIHB1YmxpYyBzZXRTdWdnZXN0aW9ucyhzdWdnZXN0aW9uczphbnlbXSwgc2hvdz86Ym9vbGVhbik6dm9pZCB7XG4gICAgaWYgKHRoaXMucmVtb3ZlRHVwbGljYXRlU3VnZ2VzdGlvbnMpIHtcbiAgICAgIHN1Z2dlc3Rpb25zID0gdGhpcy5yZW1vdmVEdXBsaWNhdGVzKHN1Z2dlc3Rpb25zKTtcbiAgICAgIHN1Z2dlc3Rpb25zID0gdGhpcy5yZW1vdmVFeGNsdWRlZChzdWdnZXN0aW9ucyk7XG4gICAgfVxuXG4gICAgdGhpcy5zdWdnZXN0aW9ucyA9IHN1Z2dlc3Rpb25zO1xuXG4gICAgaWYgKHNob3cgfHwgdHlwZW9mIHNob3cgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICB0aGlzLnNob3dJdGVtTGlzdCgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmF1dG9Gb2N1c1N1Z2dlc3Rpb24pIHtcbiAgICAgIGlmICh0aGlzLnN1Z2dlc3Rpb25zLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICB0aGlzLmZvY3VzZWRPcHRpb24gPSAwO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgY3VycmVudCBpbnB1dCB2YWx1ZVxuICAgKlxuICAgKiBAcGFyYW0gc2VsZWN0aW9uXG4gICAqL1xuICBwdWJsaWMgc2V0VmFsdWUoc2VsZWN0aW9uOiBhbnkpOnZvaWQge1xuICAgIHRoaXMuZm9ybVZhbHVlID0gdGhpcy5nZXRGb3JtVmFsdWUoc2VsZWN0aW9uKTtcbiAgICB0aGlzLmtleXdvcmQgPSB0aGlzLmdldExhYmVsKHNlbGVjdGlvbik7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLyoqXG4gICAqIFNob3cgaXRlbSBsaXN0XG4gICAqL1xuICBwdWJsaWMgc2hvd0l0ZW1MaXN0KCk6dm9pZCB7XG4gICAgaWYgKHRoaXMuc2hvd1N1Z2dlc3Rpb25zID09PSBmYWxzZSkge1xuICAgICAgdGhpcy5zaG93TGlzdENoYW5nZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIHRoaXMuc2hvd1N1Z2dlc3Rpb25zID0gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIG1vZGVsXG4gICAqL1xuICBwdWJsaWMgdXBkYXRlTW9kZWwoZW50ZXJlZFRleHQ6c3RyaW5nKTp2b2lkIHtcbiAgICBpZiAoZW50ZXJlZFRleHQgIT09IHRoaXMuZm9ybVZhbHVlKSB7XG4gICAgICB0aGlzLmZvcm1WYWx1ZSA9IGVudGVyZWRUZXh0O1xuXG4gICAgICBpZiAoIXRoaXMubXVsdGkpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZCA9IG51bGw7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMub25DaGFuZ2VDYWxsYmFjaykge1xuICAgICAgdGhpcy5vbkNoYW5nZUNhbGxiYWNrKHRoaXMuZm9ybVZhbHVlKTtcbiAgICB9XG5cbiAgICB0aGlzLm1vZGVsQ2hhbmdlLmVtaXQodGhpcy5zZWxlY3RlZCk7XG4gIH1cblxuICAvKipcbiAgICogV3JpdGUgdmFsdWVcbiAgICpcbiAgICogQHBhcmFtIHZhbHVlXG4gICAqL1xuICBwdWJsaWMgd3JpdGVWYWx1ZSh2YWx1ZTphbnkpOnZvaWQge1xuICAgIGlmICh2YWx1ZSAhPT0gdGhpcy5zZWxlY3Rpb24pIHtcbiAgICAgIHRoaXMuc2VsZWN0aW9uID0gdmFsdWUgfHwgbnVsbDtcbiAgICAgIHRoaXMuZm9ybVZhbHVlID0gdGhpcy5nZXRGb3JtVmFsdWUodGhpcy5zZWxlY3Rpb24pO1xuICAgICAgdGhpcy5rZXl3b3JkID0gdGhpcy5nZXRMYWJlbCh0aGlzLnNlbGVjdGlvbik7XG4gICAgfVxuICB9XG59XG4iXX0=