import * as tslib_1 from "tslib";
import { Component, Input, Output, EventEmitter, ViewChild, HostListener, ElementRef } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { from, Observable, Subject } from 'rxjs';
import { finalize } from 'rxjs/operators';
import { AutoCompleteOptions } from '../auto-complete-options.model';
import { AutoCompleteStyles } from '../auto-complete-styles.model';
var AutoCompleteComponent = /** @class */ (function () {
    /**
     * Create a new instance
     */
    function AutoCompleteComponent() {
        this.alwaysShowList = false;
        this.autoFocusSuggestion = true;
        this.enableBrowserAutoComplete = false;
        this.clearInvalidInput = true;
        this.disabled = false;
        this.exclude = [];
        this.frontIcon = false;
        this.hideListOnSelection = true;
        this.location = 'auto';
        this.maxResults = 8;
        this.maxSelected = null;
        this.multi = false;
        this.name = '';
        this.removeButtonClasses = '';
        this.removeButtonColor = 'primary';
        this.removeButtonIcon = 'close-circle';
        this.removeButtonSlot = 'end';
        this.removeDuplicateSuggestions = true;
        this.selectOnTabOut = true;
        this.styles = new AutoCompleteStyles;
        this.useIonInput = false;
        this.autocompleteOptions = new AutoCompleteOptions();
        this.onTouchedCallback = false;
        this.onChangeCallback = false;
        this.hasFocus = false;
        this.isLoading = false;
        this.focusedOption = -1;
        this.showSuggestions = false;
        this.showListChanged = false;
        this.autoBlur = new EventEmitter();
        this.autoFocus = new EventEmitter();
        this.blur = new EventEmitter();
        this.focus = new EventEmitter();
        this.ionAutoInput = new EventEmitter();
        this.itemsChange = new EventEmitter();
        this.itemsCleared = new EventEmitter();
        this.itemsHidden = new EventEmitter();
        this.itemRemoved = new EventEmitter();
        this.itemSelected = new EventEmitter();
        this.itemsShown = new EventEmitter();
        this.modelChange = new EventEmitter();
        this.keyword = '';
        this.suggestions = [];
        this.autocompleteOptions = new AutoCompleteOptions();
        this.defaultOpts = new AutoCompleteOptions();
        this.selected = [];
    }
    AutoCompleteComponent_1 = AutoCompleteComponent;
    Object.defineProperty(AutoCompleteComponent.prototype, "model", {
        get: function () {
            var model = this.selected;
            if (!this.multi && typeof this.selected.length !== 'undefined') {
                if (this.selected.length === 0) {
                    model = null;
                }
                else {
                    model = this.selected[0];
                }
            }
            return model;
        },
        set: function (selected) {
            if (typeof selected !== 'undefined' && selected !== null) {
                this.selected = selected;
                this.keyword = this.getLabel(selected);
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AutoCompleteComponent.prototype, "options", {
        set: function (options) {
            this.autocompleteOptions = new AutoCompleteOptions();
            var keys = Object.keys(this.autocompleteOptions);
            var keysLength = keys.length;
            for (var i = 0; i < keysLength; i++) {
                var key = keys[i];
                if (typeof options[key] !== 'undefined') {
                    this.autocompleteOptions[key] = options[key];
                }
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AutoCompleteComponent.prototype, "eager", {
        set: function (eager) {
            if (eager) {
                this.getItems(null, false);
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AutoCompleteComponent.prototype, "showList", {
        get: function () {
            return this.showSuggestions;
        },
        set: function (value) {
            if (typeof value === 'undefined') {
                return;
            }
            if (this.showSuggestions === value) {
                return;
            }
            this.showSuggestions = value === true;
            this.showListChanged = true;
        },
        enumerable: true,
        configurable: true
    });
    /**
     *
     */
    AutoCompleteComponent.prototype.ngAfterViewChecked = function () {
        if (this.showListChanged) {
            this.showListChanged = false;
            this.showSuggestions ? this.itemsShown.emit() : this.itemsHidden.emit();
        }
    };
    AutoCompleteComponent.prototype.ngDoCheck = function () {
        if (!this.hasFocus) {
            if (this.clearInvalidInput && (this.selected === null || this.multi)) {
                if (this.keyword !== '') {
                    this.keyword = '';
                }
                if (this.inputElem && this.inputElem.nativeElement) {
                    if (this.inputElem.nativeElement.children && this.inputElem.nativeElement.children.length !== 0) {
                        if (this.inputElem.nativeElement.children[0].children && this.inputElem.nativeElement.children[0].children.length !== 0) {
                            if (this.inputElem.nativeElement.children[0].children[0].value) {
                                this.inputElem.nativeElement.children[0].children[0].value = '';
                            }
                        }
                    }
                }
                if (this.searchbarElem && this.searchbarElem.nativeElement) {
                    if (this.searchbarElem.nativeElement.children && this.searchbarElem.nativeElement.children.length !== 0) {
                        if (this.searchbarElem.nativeElement.children[0].children) {
                            if (this.searchbarElem.nativeElement.children[0].children.length !== 0) {
                                if (this.searchbarElem.nativeElement.children[0].children[0].value) {
                                    this.searchbarElem.nativeElement.children[0].children[0].value = '';
                                }
                            }
                        }
                    }
                }
            }
        }
    };
    /**
     * Handle document click
     *
     * @param event
     *
     * @private
     */
    AutoCompleteComponent.prototype.documentClickHandler = function (event) {
        if ((this.searchbarElem && this.searchbarElem.nativeElement && !this.searchbarElem.nativeElement.contains(event.target))
            ||
                (!this.inputElem && this.inputElem.nativeElement && this.inputElem.nativeElement.contains(event.target))) {
            this.hideItemList();
        }
    };
    /**
     * Get value from form
     *
     * @param selection
     *
     * @private
     */
    AutoCompleteComponent.prototype.getFormValue = function (selection) {
        if (selection == null || typeof this.dataProvider === 'function') {
            return null;
        }
        var attr = this.dataProvider.formValueAttribute == null ?
            this.dataProvider.labelAttribute : this.dataProvider.formValueAttribute;
        if (typeof selection === 'object' && attr) {
            return selection[attr];
        }
        return selection;
    };
    /**
     * Get element's position on screen
     *
     * @param el
     *
     * @private
     */
    AutoCompleteComponent.prototype._getPosition = function (el) {
        var xPos = 0;
        var yPos = 0;
        while (el) {
            if (el.tagName === 'BODY') {
                var xScroll = el.scrollLeft || document.documentElement.scrollLeft;
                var yScroll = el.scrollTop || document.documentElement.scrollTop;
                xPos += (el.offsetLeft - xScroll + el.clientLeft);
                yPos += (el.offsetTop - yScroll + el.clientTop);
            }
            else {
                xPos += (el.offsetLeft - el.scrollLeft + el.clientLeft);
                yPos += (el.offsetTop - el.scrollTop + el.clientTop);
            }
            el = el.offsetParent;
        }
        return {
            x: xPos,
            y: yPos
        };
    };
    AutoCompleteComponent.prototype.clickClear = function () {
        this.clearValue(true);
        this.itemsCleared.emit(true);
    };
    /**
     * Clear current input value
     *
     * @param hideItemList
     */
    AutoCompleteComponent.prototype.clearValue = function (hideItemList) {
        if (hideItemList === void 0) { hideItemList = false; }
        this.keyword = '';
        this.selection = null;
        this.formValue = null;
        if (hideItemList) {
            this.hideItemList();
        }
        this.focusedOption = -1;
        return;
    };
    /**
     * Get items for auto-complete
     *
     * @param event
     * @param show
     */
    AutoCompleteComponent.prototype.getItems = function (event, show) {
        var _this = this;
        this.isLoading = true;
        if (this.promise) {
            clearTimeout(this.promise);
        }
        this.promise = setTimeout(function () {
            if (event) {
                _this.keyword = event.detail.target.value;
            }
            var result;
            if (_this.showResultsFirst && _this.keyword.trim() === '') {
                _this.keyword = '';
            }
            if (typeof _this.dataProvider === 'function') {
                result = _this.dataProvider(_this.keyword);
                _this.setSuggestions(result, show);
                _this.isLoading = false;
            }
            else {
                result = _this.dataProvider.getResults(_this.keyword);
                if (result instanceof Subject) {
                    result = result.asObservable();
                }
                else if (result instanceof Promise) {
                    result = from(result);
                }
                if (result instanceof Observable) {
                    result.pipe(finalize(function () {
                        _this.isLoading = false;
                    })).subscribe(function (results) {
                        _this.setSuggestions(results, show);
                    }, function (error) { return console.error(error); });
                }
                else {
                    _this.setSuggestions(result, show);
                    _this.isLoading = false;
                }
            }
            _this.ionAutoInput.emit(_this.keyword);
        }, this.autocompleteOptions.debounce);
    };
    /**
     * Get an item's label
     *
     * @param selection
     */
    AutoCompleteComponent.prototype.getLabel = function (selection) {
        if (selection == null || typeof this.dataProvider === 'function') {
            return '';
        }
        var attr = this.dataProvider.formValueAttribute == null ?
            this.dataProvider.labelAttribute : this.dataProvider.formValueAttribute;
        var value = selection;
        if (this.dataProvider.getItemLabel) {
            value = this.dataProvider.getItemLabel(value);
        }
        if (!this.multi && typeof value !== 'undefined' && Object.prototype.toString.call(value) === '[object Array]') {
            if (value.length === 0) {
                return '';
            }
            else {
                value = value[0];
            }
        }
        if (typeof value === 'object' && attr) {
            return value[attr] || '';
        }
        return value || '';
    };
    /**
     * Get current selection
     */
    AutoCompleteComponent.prototype.getSelection = function () {
        if (this.multi) {
            return this.selection;
        }
        else {
            return this.selected;
        }
    };
    /**
     * Get menu style
     */
    AutoCompleteComponent.prototype.listStyles = function () {
        var listLocationStyles = this.listLocationStyles();
        return tslib_1.__assign({}, listLocationStyles, this.styles.list);
    };
    AutoCompleteComponent.prototype.listLocationStyles = function () {
        var location = this.location;
        if (this.location === 'auto') {
            var elementY = this._getPosition(this.searchbarElem.nativeElement).y;
            var windowY = window.innerHeight;
            if (elementY > windowY - elementY) {
                location = 'top';
            }
            else {
                location = 'bottom';
            }
        }
        if (location === 'bottom') {
            return {};
        }
        else {
            return {
                'bottom': '37px'
            };
        }
    };
    /**
     * Get current input value
     */
    AutoCompleteComponent.prototype.getValue = function () {
        return this.formValue;
    };
    /**
     * Handles tab key press.
     * If `selectOnTabOut` is `true`, will select currently focused item
     *
     * @param event
     */
    AutoCompleteComponent.prototype.handleTabOut = function (event) {
        if (this.selectOnTabOut && this.suggestions.length !== 0) {
            if (this.focusedOption !== -1) {
                this.selectItem(this.suggestions[this.focusedOption]);
            }
            else {
                this.hideItemList();
            }
        }
        else {
            this.hideItemList();
        }
        this.onBlur(event);
    };
    /**
     * Handle tap
     *
     * @param event
     */
    AutoCompleteComponent.prototype.handleTap = function (event) {
        if (this.showResultsFirst || this.keyword.length > 0) {
            this.getItems();
        }
    };
    /**
     * Handle tap when selecting an item
     *
     * @param $event
     * @param suggestion
     */
    AutoCompleteComponent.prototype.handleSelectTap = function ($event, suggestion) {
        if (typeof suggestion !== 'undefined') {
            this.selectItem(suggestion);
            if ($event.srcEvent) {
                if ($event.srcEvent.stopPropagation) {
                    $event.srcEvent.stopPropagation();
                }
                if ($event.srcEvent.preventDefault) {
                    $event.srcEvent.preventDefault();
                }
            }
            else if ($event.preventDefault) {
                $event.preventDefault();
            }
        }
        return false;
    };
    /**
     * Hide item list
     */
    AutoCompleteComponent.prototype.hideItemList = function () {
        if (this.showSuggestions === false && this.alwaysShowList === false) {
            this.showListChanged = true;
        }
        this.showSuggestions = this.alwaysShowList;
        this.focusedOption = -1;
    };
    AutoCompleteComponent.prototype.highlightItem = function (direction) {
        if (this.showSuggestions === false) {
            this.showItemList();
        }
        var max = this.suggestions.length - 1;
        if (direction < 0) {
            if (this.focusedOption === -1 || this.focusedOption === max) {
                this.focusedOption = 0;
            }
            else {
                this.focusedOption++;
            }
        }
        else if (direction > 0) {
            if (this.focusedOption === -1 || this.focusedOption === 0) {
                this.focusedOption = max;
            }
            else {
                this.focusedOption--;
            }
        }
    };
    /**
     * Fired when the input focused
     */
    AutoCompleteComponent.prototype.onFocus = function (event) {
        this.hasFocus = true;
        this.getItems();
        event = this._reflectName(event);
        this.autoFocus.emit(event);
        this.focus.emit(event);
    };
    /**
     * Fired when the input focused
     */
    AutoCompleteComponent.prototype.onBlur = function (event) {
        this.hasFocus = false;
        event = this._reflectName(event);
        this.autoBlur.emit(event);
        this.blur.emit(event);
    };
    AutoCompleteComponent.prototype._reflectName = function (event) {
        if (typeof event.srcElement.attributes['ng-reflect-name'] === 'object') {
            event.srcElement.name = event.srcElement.attributes['ng-reflect-name'].value;
        }
        return event;
    };
    /**
     * Register onChangeCallback
     *
     * @param fn
     */
    AutoCompleteComponent.prototype.registerOnChange = function (fn) {
        this.onChangeCallback = fn;
    };
    /**
     * Register onTouchedCallback
     *
     * @param fn
     */
    AutoCompleteComponent.prototype.registerOnTouched = function (fn) {
        this.onTouchedCallback = fn;
    };
    /**
     * Remove already selected suggestions
     *
     * @param suggestions
     */
    AutoCompleteComponent.prototype.removeDuplicates = function (suggestions) {
        var selectedCount = this.selected ? this.selected.length : 0;
        var suggestionCount = suggestions.length;
        for (var i = 0; i < selectedCount; i++) {
            var selectedLabel = this.getLabel(this.selected[i]);
            for (var j = 0; j < suggestionCount; j++) {
                var suggestedLabel = this.getLabel(suggestions[j]);
                if (selectedLabel === suggestedLabel) {
                    suggestions.splice(j, 1);
                }
            }
        }
        return suggestions;
    };
    AutoCompleteComponent.prototype.removeExcluded = function (suggestions) {
        var excludedCount = this.exclude.length;
        for (var i = 0; i < excludedCount; i++) {
            var excludeLabel = this.exclude[i];
            if (typeof excludeLabel === 'object') {
                excludeLabel = this.getLabel(excludeLabel);
            }
            var suggestionCount = suggestions.length;
            for (var j = 0; j < suggestionCount; j++) {
                var suggestedLabel = this.getLabel(suggestions[j]);
                if (excludeLabel === suggestedLabel) {
                    suggestions.splice(j, 1);
                    break;
                }
            }
        }
        return suggestions;
    };
    /**
     * Remove item from selected
     *
     * @param selection
     * @param notify?
     */
    AutoCompleteComponent.prototype.removeItem = function (selection, notify) {
        var count = this.selected ? this.selected.length : 0;
        for (var i = 0; i < count; i++) {
            var item = this.selected[i];
            var selectedLabel = this.getLabel(selection);
            var itemLabel = this.getLabel(item);
            if (selectedLabel === itemLabel) {
                this.selected.splice(i, 1);
            }
        }
        notify = typeof notify === 'undefined' ? true : notify;
        if (notify) {
            this.itemRemoved.emit(selection);
            this.itemsChange.emit(this.selected);
        }
        this.modelChange.emit(this.selected);
    };
    /**
     * Select item from list
     *
     * @param selection
     **/
    AutoCompleteComponent.prototype.selectItem = function (selection) {
        this.keyword = this.getLabel(selection);
        this.formValue = this.getFormValue(selection);
        this.hideItemList();
        this.updateModel(this.formValue);
        if (this.hideListOnSelection) {
            this.hideItemList();
        }
        if (this.multi) {
            if (this.maxSelected === null || this.selected.length <= this.maxSelected) {
                this.clearValue();
                this.selected.push(selection);
                this.itemsChange.emit(this.selected);
            }
            else {
                return;
            }
        }
        else {
            this.selection = selection;
            this.selected = [selection];
            this.itemsChange.emit(selection);
        }
        this.itemSelected.emit(selection);
        this.modelChange.emit(this.selected);
    };
    /**
     * Set focus of searchbar
     */
    AutoCompleteComponent.prototype.setFocus = function () {
        if (this.useIonInput && this.inputElem) {
            this.inputElem.nativeElement.setFocus();
        }
        else if (this.searchbarElem) {
            this.searchbarElem.nativeElement.setFocus();
        }
    };
    /**
     * Set suggestions
     *
     * @param suggestions
     * @param show
     */
    AutoCompleteComponent.prototype.setSuggestions = function (suggestions, show) {
        if (this.removeDuplicateSuggestions) {
            suggestions = this.removeDuplicates(suggestions);
            suggestions = this.removeExcluded(suggestions);
        }
        this.suggestions = suggestions;
        if (show || typeof show === 'undefined') {
            this.showItemList();
        }
        if (this.autoFocusSuggestion) {
            if (this.suggestions.length !== 0) {
                this.focusedOption = 0;
            }
        }
    };
    /**
     * Set current input value
     *
     * @param selection
     */
    AutoCompleteComponent.prototype.setValue = function (selection) {
        this.formValue = this.getFormValue(selection);
        this.keyword = this.getLabel(selection);
        return;
    };
    /**
     * Show item list
     */
    AutoCompleteComponent.prototype.showItemList = function () {
        if (this.showSuggestions === false) {
            this.showListChanged = true;
        }
        this.showSuggestions = true;
    };
    /**
     * Update the model
     */
    AutoCompleteComponent.prototype.updateModel = function (enteredText) {
        if (enteredText !== this.formValue) {
            this.formValue = enteredText;
            if (!this.multi) {
                this.selected = null;
            }
        }
        if (this.onChangeCallback) {
            this.onChangeCallback(this.formValue);
        }
        this.modelChange.emit(this.selected);
    };
    /**
     * Write value
     *
     * @param value
     */
    AutoCompleteComponent.prototype.writeValue = function (value) {
        if (value !== this.selection) {
            this.selection = value || null;
            this.formValue = this.getFormValue(this.selection);
            this.keyword = this.getLabel(this.selection);
        }
    };
    var AutoCompleteComponent_1;
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "alwaysShowList", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "autoFocusSuggestion", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "enableBrowserAutoComplete", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "clearInvalidInput", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "dataProvider", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "disabled", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "emptyTemplate", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "exclude", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "frontIcon", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "hideListOnSelection", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "keyword", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "location", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "maxResults", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "maxSelected", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "multi", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "name", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "removeButtonClasses", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "removeButtonColor", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "removeButtonIcon", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "removeButtonSlot", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "removeDuplicateSuggestions", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "selectionTemplate", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "selectOnTabOut", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "showResultsFirst", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "styles", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "template", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "useIonInput", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "model", null);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "options", null);
    tslib_1.__decorate([
        Output()
    ], AutoCompleteComponent.prototype, "modelChange", void 0);
    tslib_1.__decorate([
        Input()
    ], AutoCompleteComponent.prototype, "eager", null);
    tslib_1.__decorate([
        Output()
    ], AutoCompleteComponent.prototype, "blur", void 0);
    tslib_1.__decorate([
        Output()
    ], AutoCompleteComponent.prototype, "autoFocus", void 0);
    tslib_1.__decorate([
        Output()
    ], AutoCompleteComponent.prototype, "autoBlur", void 0);
    tslib_1.__decorate([
        Output()
    ], AutoCompleteComponent.prototype, "focus", void 0);
    tslib_1.__decorate([
        Output()
    ], AutoCompleteComponent.prototype, "ionAutoInput", void 0);
    tslib_1.__decorate([
        Output()
    ], AutoCompleteComponent.prototype, "itemsChange", void 0);
    tslib_1.__decorate([
        Output()
    ], AutoCompleteComponent.prototype, "itemsCleared", void 0);
    tslib_1.__decorate([
        Output()
    ], AutoCompleteComponent.prototype, "itemsHidden", void 0);
    tslib_1.__decorate([
        Output()
    ], AutoCompleteComponent.prototype, "itemRemoved", void 0);
    tslib_1.__decorate([
        Output()
    ], AutoCompleteComponent.prototype, "itemSelected", void 0);
    tslib_1.__decorate([
        Output()
    ], AutoCompleteComponent.prototype, "itemsShown", void 0);
    tslib_1.__decorate([
        ViewChild('searchbarElem', {
            read: ElementRef,
            static: false
        })
    ], AutoCompleteComponent.prototype, "searchbarElem", void 0);
    tslib_1.__decorate([
        ViewChild('inputElem', {
            read: ElementRef,
            static: false
        })
    ], AutoCompleteComponent.prototype, "inputElem", void 0);
    tslib_1.__decorate([
        HostListener('document:click', ['$event'])
    ], AutoCompleteComponent.prototype, "documentClickHandler", null);
    AutoCompleteComponent = AutoCompleteComponent_1 = tslib_1.__decorate([
        Component({
            providers: [
                {
                    provide: NG_VALUE_ACCESSOR,
                    useExisting: AutoCompleteComponent_1,
                    multi: true
                }
            ],
            selector: 'ion-auto-complete',
            template: "<ng-template #defaultSelection\n             let-attrs=\"attrs\">\n    <ion-chip class=\"{{ attrs.removeButtonClasses }}\"\n              [color]=\"attrs.removeButtonColor\"\n              [outline]=\"true\">\n        <ion-icon *ngIf=\"frontIcon\"\n                  [name]=\"frontIcon\"\n                  [slot]=\"'start'\"\n                  color=\"primary\"></ion-icon>\n\n        <ion-label>{{ attrs.label }}</ion-label>\n\n        <ion-icon *ngIf=\"attrs.removeButtonIcon\"\n                  [name]=\"attrs.removeButtonIcon\"\n                  [slot]=\"attrs.removeButtonSlot\"></ion-icon>\n    </ion-chip>\n</ng-template>\n\n<div *ngIf=\"multi\">\n    <div *ngFor=\"let item of selected\"\n         class=\"selected-items\"\n         (click)=\"removeItem(item)\">\n        <ng-template [ngTemplateOutlet]=\"selectionTemplate || defaultSelection\"\n                     [ngTemplateOutletContext]=\"{\n                            attrs: {\n                              data:                item,\n                              label:               getLabel(item),\n                              removeButtonClasses: removeButtonClasses,\n                              removeButtonColor:   removeButtonColor,\n                              removeButtonIcon:    removeButtonIcon,\n                              removeButtonSlot:    removeButtonSlot\n                            }\n                         }\"></ng-template>\n    </div>\n</div>\n\n<ion-input #inputElem\n           [autocomplete]=\"enableBrowserAutoComplete ? 'on' : 'off'\"\n           [name]=\"name\"\n           (ionInput)=\"getItems($event)\"\n           (tap)=\"handleTap($event)\"\n           [(ngModel)]=\"keyword\"\n           (ngModelChange)=\"updateModel($event)\"\n           [placeholder]=\"autocompleteOptions.placeholder == null ? defaultOpts.placeholder : autocompleteOptions.placeholder\"\n           [type]=\"autocompleteOptions.type == null ? defaultOpts.type : autocompleteOptions.type\"\n           [clearOnEdit]=\"autocompleteOptions.clearOnEdit == null ? defaultOpts.clearOnEdit : autocompleteOptions.clearOnEdit\"\n           [clearInput]=\"autocompleteOptions.clearInput == null ? defaultOpts.clearInput : autocompleteOptions.clearInput\"\n           [color]=\"autocompleteOptions.color == null ? null : autocompleteOptions.color\"\n           [mode]=\"autocompleteOptions.mode == null ? defaultOpts.mode : autocompleteOptions.mode\"\n           [disabled]=\"disabled || (this.maxSelected !== null && this.selected.length >= this.maxSelected)\"\n           [ngClass]=\"{ 'hidden': !useIonInput, 'loading': isLoading }\"\n           [ngStyle]=\"styles.searchbar\"\n           (keydown.tab)=\"handleTabOut($event)\"\n           (keydown.shift.tab)=\"hideItemList()\"\n           (keyup.arrowDown)=\"highlightItem(-1)\"\n           (keyup.arrowUp)=\"highlightItem(1)\"\n           (keyup.enter)=\"handleSelectTap($event, suggestions[focusedOption])\"\n           (keyup.escape)=\"hideItemList()\"\n           (ionFocus)=\"onFocus($event)\"\n           (ionBlur)=\"onBlur($event)\"></ion-input>\n\n<ion-searchbar #searchbarElem\n               [autocomplete]=\"enableBrowserAutoComplete ? 'on' : 'off'\"\n               [name]=\"name\"\n               [animated]=\"autocompleteOptions.animated == null ? defaultOpts.animated : autocompleteOptions.animated\"\n               (ionInput)=\"getItems($event)\"\n               (tap)=\"handleTap($event)\"\n               [(ngModel)]=\"keyword\"\n               (ngModelChange)=\"updateModel($event)\"\n               [cancelButtonIcon]=\"autocompleteOptions.cancelButtonIcon == null ? defaultOpts.cancelButtonIcon : autocompleteOptions.cancelButtonIcon\"\n               [cancelButtonText]=\"autocompleteOptions.cancelButtonText == null ? defaultOpts.cancelButtonText : autocompleteOptions.cancelButtonText\"\n               [clearIcon]=\"autocompleteOptions.clearIcon == null ? defaultOpts.clearIcon : autocompleteOptions.clearIcon\"\n               [color]=\"autocompleteOptions.color == null ? null : autocompleteOptions.color\"\n               [showCancelButton]=\"autocompleteOptions.showCancelButton == null ?\n                                        (defaultOpts.showCancelButton ? 'always' : 'never') :\n                                        (autocompleteOptions.showCancelButton ? 'always' : 'never')\"\n               [debounce]=\"autocompleteOptions.debounce == null ? defaultOpts.debounce : autocompleteOptions.debounce\"\n               [placeholder]=\"autocompleteOptions.placeholder == null ? defaultOpts.placeholder : autocompleteOptions.placeholder\"\n               [autocorrect]=\"autocompleteOptions.autocorrect == null ? defaultOpts.autocorrect : autocompleteOptions.autocorrect\"\n               [mode]=\"autocompleteOptions.mode == null ? defaultOpts.mode : autocompleteOptions.mode\"\n               [searchIcon]=\"autocompleteOptions.searchIcon == null ? defaultOpts.searchIcon : autocompleteOptions.searchIcon\"\n               [spellcheck]=\"autocompleteOptions.spellcheck == null ? defaultOpts.spellcheck : autocompleteOptions.spellcheck\"\n               [type]=\"autocompleteOptions.type == null ? defaultOpts.type : autocompleteOptions.type\"\n               [ngClass]=\"{ 'hidden': useIonInput, 'loading': isLoading, 'disabled': disabled || (this.maxSelected !== null && this.selected.length >= this.maxSelected) }\"\n               [ngStyle]=\"styles.searchbar\"\n               (keydown.tab)=\"handleTabOut($event)\"\n               (keydown.shift.tab)=\"hideItemList()\"\n               (keyup.arrowDown)=\"highlightItem(-1)\"\n               (keyup.arrowUp)=\"highlightItem(1)\"\n               (keyup.enter)=\"handleSelectTap($event, suggestions[focusedOption])\"\n               (keyup.escape)=\"hideItemList()\"\n               (ionClear)=\"clickClear()\"\n               (ionFocus)=\"onFocus($event)\"\n               (ionBlur)=\"onBlur($event)\"></ion-searchbar>\n\n<ng-template #defaultTemplate\n             let-attrs=\"attrs\">\n    <span [innerHTML]='attrs.label | boldprefix:attrs.keyword'></span>\n</ng-template>\n\n<ng-template #defaultEmptyTemplate\n             let-attrs=\"attrs\"\n             class=\"ion-text-center\">\n    {{ autocompleteOptions.noItems }}\n</ng-template>\n\n<ul *ngIf=\"!(disabled || (this.maxSelected !== null && this.selected.length >= this.maxSelected)) && suggestions.length > 0 && showSuggestions\"\n    [ngStyle]=\"listStyles()\">\n    <li *ngFor=\"let suggestion of suggestions| slice:0:maxResults; let index = index\"\n        [ngClass]=\"{ 'focus': focusedOption === index }\"\n        [ngStyle]=\"styles.listItem\"\n        (mouseenter)=\"focusedOption = index\"\n        (click)=\"handleSelectTap($event, suggestion)\"\n        (tap)=\"handleSelectTap($event, suggestion)\">\n        <ng-template [ngTemplateOutlet]=\"template || defaultTemplate\"\n                     [ngTemplateOutletContext]=\"{\n                        attrs:{\n                          data:               suggestion,\n                          label:              getLabel(suggestion),\n                          keyword:            keyword,\n                          formValue:          getFormValue(suggestion),\n                          labelAttribute:     getLabel(suggestion),\n                          formValueAttribute: getFormValue(suggestion)\n                        }\n                     }\"></ng-template>\n    </li>\n</ul>\n\n<ul *ngIf=\"suggestions.length === 0 && showSuggestions\"\n    [ngStyle]=\"listStyles()\">\n    <li [ngStyle]=\"styles.listItem\">\n        <ng-template [ngTemplateOutlet]=\"emptyTemplate || defaultEmptyTemplate\"\n                     [ngTemplateOutletContext]=\"{\n                        attrs:{\n                          keyword: keyword\n                        }\n                     }\"></ng-template>\n    </li>\n</ul>\n",
            styles: ["ion-auto-complete{overflow:hidden!important;width:90vw;display:inline-block}ion-auto-complete ion-searchbar{padding:1px!important}ion-auto-complete .disabled input.searchbar-input{pointer-events:none;cursor:default}ion-auto-complete ul{position:absolute;width:90vw;margin-top:0;background:#fff;list-style-type:none;padding:0;left:16px;z-index:999;box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.2),0 1px 5px 0 rgba(0,0,0,.12)}ion-auto-complete ul li{padding:15px;border-bottom:1px solid #c1c1c1}ion-auto-complete ul ion-auto-complete-item{height:40px;width:100%}ion-auto-complete ul li:last-child{border:none}ion-auto-complete ul li.focus,ion-auto-complete ul li:focus{cursor:pointer;background:#f1f1f1}ion-auto-complete .hidden{display:none}ion-auto-complete .loading input.searchbar-input{background:url(/assets/loading.gif) right 4px center/25px 25px no-repeat #fff}ion-auto-complete .searchbar-clear-button.sc-ion-searchbar-md{right:34px}ion-auto-complete .selected-items{float:left}"]
        })
    ], AutoCompleteComponent);
    return AutoCompleteComponent;
}());
export { AutoCompleteComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0by1jb21wbGV0ZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9pb25pYzQtYXV0by1jb21wbGV0ZS8iLCJzb3VyY2VzIjpbImF1dG8tY29tcGxldGUvYXV0by1jb21wbGV0ZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFDTCxTQUFTLEVBRVQsS0FBSyxFQUNMLE1BQU0sRUFDTixZQUFZLEVBRVosU0FBUyxFQUNULFlBQVksRUFDWixVQUFVLEVBRVgsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUF1QixpQkFBaUIsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBRXZFLE9BQU8sRUFBQyxJQUFJLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUMvQyxPQUFPLEVBQUMsUUFBUSxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFFeEMsT0FBTyxFQUFDLG1CQUFtQixFQUFDLE1BQU0sZ0NBQWdDLENBQUM7QUFFbkUsT0FBTyxFQUFDLGtCQUFrQixFQUFDLE1BQU0sK0JBQStCLENBQUM7QUFnQmpFO0lBNklFOztPQUVHO0lBQ0g7UUEvSWdCLG1CQUFjLEdBQVcsS0FBSyxDQUFDO1FBQy9CLHdCQUFtQixHQUFXLElBQUksQ0FBQztRQUNuQyw4QkFBeUIsR0FBVyxLQUFLLENBQUM7UUFDMUMsc0JBQWlCLEdBQVcsSUFBSSxDQUFDO1FBRWpDLGFBQVEsR0FBVyxLQUFLLENBQUM7UUFFekIsWUFBTyxHQUFTLEVBQUUsQ0FBQztRQUNuQixjQUFTLEdBQWdCLEtBQUssQ0FBQztRQUMvQix3QkFBbUIsR0FBVyxJQUFJLENBQUM7UUFFbkMsYUFBUSxHQUFVLE1BQU0sQ0FBQztRQUN6QixlQUFVLEdBQVUsQ0FBQyxDQUFDO1FBQ3RCLGdCQUFXLEdBQVUsSUFBSSxDQUFDO1FBQzFCLFVBQUssR0FBVyxLQUFLLENBQUM7UUFDdEIsU0FBSSxHQUFVLEVBQUUsQ0FBQztRQUNqQix3QkFBbUIsR0FBVSxFQUFFLENBQUM7UUFDaEMsc0JBQWlCLEdBQVUsU0FBUyxDQUFDO1FBQ3JDLHFCQUFnQixHQUFnQixjQUFjLENBQUM7UUFDL0MscUJBQWdCLEdBQVUsS0FBSyxDQUFDO1FBQ2hDLCtCQUEwQixHQUFXLElBQUksQ0FBQztRQUUxQyxtQkFBYyxHQUFXLElBQUksQ0FBQztRQUU5QixXQUFNLEdBQUcsSUFBSSxrQkFBa0IsQ0FBQztRQUVoQyxnQkFBVyxHQUFXLEtBQUssQ0FBQztRQXdCckMsd0JBQW1CLEdBQXVCLElBQUksbUJBQW1CLEVBQUUsQ0FBQztRQXlEbkUsc0JBQWlCLEdBQWtCLEtBQUssQ0FBQztRQUN6QyxxQkFBZ0IsR0FBa0IsS0FBSyxDQUFDO1FBR3pDLGFBQVEsR0FBVyxLQUFLLENBQUM7UUFDekIsY0FBUyxHQUFXLEtBQUssQ0FBQztRQUMxQixrQkFBYSxHQUFVLENBQUMsQ0FBQyxDQUFDO1FBSTFCLG9CQUFlLEdBQVcsS0FBSyxDQUFDO1FBcUIvQixvQkFBZSxHQUFXLEtBQUssQ0FBQztRQU10QyxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFDeEMsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBQ3pDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUNwQyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFDckMsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO1FBQy9DLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUMzQyxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksWUFBWSxFQUFXLENBQUM7UUFDaEQsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBQzNDLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUMzQyxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFDNUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBQzFDLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxZQUFZLEVBQWEsQ0FBQztRQUVqRCxJQUFJLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNsQixJQUFJLENBQUMsV0FBVyxHQUFHLEVBQUUsQ0FBQztRQUV0QixJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxtQkFBbUIsRUFBRSxDQUFDO1FBRXJELElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxtQkFBbUIsRUFBRSxDQUFDO1FBRTdDLElBQUksQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFDO0lBQ3JCLENBQUM7OEJBdEtVLHFCQUFxQjtJQThCaEMsc0JBQUksd0NBQUs7YUFBVDtZQUNFLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUM7WUFDMUIsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sS0FBSyxXQUFXLEVBQUU7Z0JBQzlELElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO29CQUM5QixLQUFLLEdBQUcsSUFBSSxDQUFDO2lCQUNkO3FCQUFNO29CQUNMLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO2lCQUMxQjthQUNGO1lBRUQsT0FBTyxLQUFLLENBQUM7UUFDZixDQUFDO2FBRUQsVUFBVSxRQUFrQjtZQUMxQixJQUFJLE9BQU8sUUFBUSxLQUFLLFdBQVcsSUFBSSxRQUFRLEtBQUssSUFBSSxFQUFFO2dCQUN4RCxJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztnQkFFekIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFBO2FBQ3ZDO1FBQ0gsQ0FBQzs7O09BUkE7SUFhRCxzQkFBSSwwQ0FBTzthQUFYLFVBQVksT0FBK0I7WUFDekMsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksbUJBQW1CLEVBQUUsQ0FBQztZQUVyRCxJQUFNLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1lBRW5ELElBQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7WUFDL0IsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFVBQVUsRUFBRSxDQUFDLEVBQUUsRUFBRTtnQkFDbkMsSUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUVwQixJQUFJLE9BQU8sT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLFdBQVcsRUFBRTtvQkFDdkMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztpQkFDOUM7YUFDRjtRQUNILENBQUM7OztPQUFBO0lBS0Qsc0JBQUksd0NBQUs7YUFBVCxVQUFVLEtBQWE7WUFDckIsSUFBSSxLQUFLLEVBQUU7Z0JBQ1QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7YUFDNUI7UUFDSCxDQUFDOzs7T0FBQTtJQThDRCxzQkFBVywyQ0FBUTthQUFuQjtZQUNFLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQztRQUM5QixDQUFDO2FBRUQsVUFBb0IsS0FBYTtZQUMvQixJQUFJLE9BQU8sS0FBSyxLQUFLLFdBQVcsRUFBRTtnQkFDaEMsT0FBTzthQUNSO1lBRUQsSUFBSSxJQUFJLENBQUMsZUFBZSxLQUFLLEtBQUssRUFBRTtnQkFDbEMsT0FBTzthQUNSO1lBRUQsSUFBSSxDQUFDLGVBQWUsR0FBRyxLQUFLLEtBQUssSUFBSSxDQUFDO1lBQ3RDLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDO1FBQzlCLENBQUM7OztPQWJBO0lBNENEOztPQUVHO0lBQ0gsa0RBQWtCLEdBQWxCO1FBQ0UsSUFBSSxJQUFJLENBQUMsZUFBZSxFQUFFO1lBQ3hCLElBQUksQ0FBQyxlQUFlLEdBQUcsS0FBSyxDQUFDO1lBQzdCLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLENBQUM7U0FDekU7SUFDSCxDQUFDO0lBRUQseUNBQVMsR0FBVDtRQUNFLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2xCLElBQUksSUFBSSxDQUFDLGlCQUFpQixJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsS0FBSyxJQUFJLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFO2dCQUNwRSxJQUFJLElBQUksQ0FBQyxPQUFPLEtBQUssRUFBRSxFQUFFO29CQUN2QixJQUFJLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztpQkFDbkI7Z0JBRUQsSUFBSSxJQUFJLENBQUMsU0FBUyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsYUFBYSxFQUFFO29CQUNsRCxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTt3QkFDL0YsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTs0QkFDdkgsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRTtnQ0FDOUQsSUFBSSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDOzZCQUNqRTt5QkFDRjtxQkFDRjtpQkFDRjtnQkFFRCxJQUFJLElBQUksQ0FBQyxhQUFhLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxhQUFhLEVBQUU7b0JBQzFELElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO3dCQUN2RyxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUU7NEJBQ3pELElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO2dDQUN0RSxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFO29DQUNsRSxJQUFJLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7aUNBQ3JFOzZCQUNGO3lCQUNGO3FCQUNGO2lCQUNGO2FBQ0Y7U0FDRjtJQUNILENBQUM7SUFFRDs7Ozs7O09BTUc7SUFFSSxvREFBb0IsR0FBM0IsVUFBNEIsS0FBVztRQUNyQyxJQUNFLENBQUMsSUFBSSxDQUFDLGFBQWEsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLGFBQWEsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBa0IsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDOztnQkFFckksQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxhQUFhLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFrQixLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsRUFDekg7WUFDQSxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7U0FDckI7SUFDSCxDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0ksNENBQVksR0FBbkIsVUFBb0IsU0FBYTtRQUMvQixJQUFJLFNBQVMsSUFBSSxJQUFJLElBQUksT0FBTyxJQUFJLENBQUMsWUFBWSxLQUFLLFVBQVUsRUFBRTtZQUNoRSxPQUFPLElBQUksQ0FBQztTQUNiO1FBRUQsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxrQkFBa0IsSUFBSSxJQUFJLENBQUMsQ0FBQztZQUNyRCxJQUFJLENBQUMsWUFBWSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxrQkFBa0IsQ0FBQztRQUU1RSxJQUFJLE9BQU8sU0FBUyxLQUFLLFFBQVEsSUFBSSxJQUFJLEVBQUU7WUFDekMsT0FBTyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDeEI7UUFFRCxPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0ssNENBQVksR0FBcEIsVUFBcUIsRUFBRTtRQUNyQixJQUFJLElBQUksR0FBRyxDQUFDLENBQUM7UUFDYixJQUFJLElBQUksR0FBRyxDQUFDLENBQUM7UUFFYixPQUFPLEVBQUUsRUFBRTtZQUNULElBQUksRUFBRSxDQUFDLE9BQU8sS0FBSyxNQUFNLEVBQUU7Z0JBQ3pCLElBQU0sT0FBTyxHQUFHLEVBQUUsQ0FBQyxVQUFVLElBQUksUUFBUSxDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUM7Z0JBQ3JFLElBQU0sT0FBTyxHQUFHLEVBQUUsQ0FBQyxTQUFTLElBQUksUUFBUSxDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUM7Z0JBRW5FLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLEdBQUcsT0FBTyxHQUFHLEVBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQztnQkFDbEQsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsR0FBRyxPQUFPLEdBQUcsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2FBQ2pEO2lCQUFNO2dCQUNMLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLEdBQUcsRUFBRSxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUMsVUFBVSxDQUFDLENBQUM7Z0JBQ3hELElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUM7YUFDdEQ7WUFFRCxFQUFFLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQztTQUN0QjtRQUNELE9BQU87WUFDTCxDQUFDLEVBQUUsSUFBSTtZQUNQLENBQUMsRUFBRSxJQUFJO1NBQ1IsQ0FBQztJQUNKLENBQUM7SUFFRCwwQ0FBVSxHQUFWO1FBQ0UsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUV0QixJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMvQixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNJLDBDQUFVLEdBQWpCLFVBQWtCLFlBQTRCO1FBQTVCLDZCQUFBLEVBQUEsb0JBQTRCO1FBQzVDLElBQUksQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2xCLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO1FBRXRCLElBQUksWUFBWSxFQUFFO1lBQ2hCLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztTQUNyQjtRQUVELElBQUksQ0FBQyxhQUFhLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFFeEIsT0FBTztJQUNULENBQUM7SUFFRDs7Ozs7T0FLRztJQUNJLHdDQUFRLEdBQWYsVUFBZ0IsS0FBTSxFQUFFLElBQWE7UUFBckMsaUJBMERDO1FBekRDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO1FBRXRCLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNoQixZQUFZLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQzVCO1FBRUQsSUFBSSxDQUFDLE9BQU8sR0FBRyxVQUFVLENBQ3ZCO1lBQ0UsSUFBSSxLQUFLLEVBQUU7Z0JBQ1QsS0FBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7YUFDMUM7WUFFRCxJQUFJLE1BQU0sQ0FBQztZQUVYLElBQUksS0FBSSxDQUFDLGdCQUFnQixJQUFJLEtBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxFQUFFO2dCQUN2RCxLQUFJLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQzthQUNuQjtZQUVELElBQUksT0FBTyxLQUFJLENBQUMsWUFBWSxLQUFLLFVBQVUsRUFBRTtnQkFDM0MsTUFBTSxHQUFHLEtBQUksQ0FBQyxZQUFZLENBQUMsS0FBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUV6QyxLQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztnQkFFbEMsS0FBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUM7YUFDeEI7aUJBQU07Z0JBQ0wsTUFBTSxHQUFHLEtBQUksQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLEtBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFFcEQsSUFBSSxNQUFNLFlBQVksT0FBTyxFQUFFO29CQUM3QixNQUFNLEdBQUcsTUFBTSxDQUFDLFlBQVksRUFBRSxDQUFDO2lCQUNoQztxQkFBTSxJQUFJLE1BQU0sWUFBWSxPQUFPLEVBQUU7b0JBQ3BDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7aUJBQ3ZCO2dCQUVELElBQUksTUFBTSxZQUFZLFVBQVUsRUFBRTtvQkFDaEMsTUFBTSxDQUFDLElBQUksQ0FDUCxRQUFRLENBQ0o7d0JBQ0UsS0FBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUM7b0JBQ3pCLENBQUMsQ0FDSixDQUNKLENBQUMsU0FBUyxDQUNQLFVBQUMsT0FBYzt3QkFDYixLQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQztvQkFDckMsQ0FBQyxFQUNELFVBQUMsS0FBVSxJQUFLLE9BQUEsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBcEIsQ0FBb0IsQ0FDdkMsQ0FBQztpQkFDSDtxQkFBTTtvQkFDTCxLQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztvQkFFbEMsS0FBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUM7aUJBQ3hCO2FBQ0Y7WUFFRCxLQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxLQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDdkMsQ0FBQyxFQUNELElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxRQUFRLENBQ2xDLENBQUM7SUFDSixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNJLHdDQUFRLEdBQWYsVUFBZ0IsU0FBbUI7UUFDakMsSUFBSSxTQUFTLElBQUksSUFBSSxJQUFJLE9BQU8sSUFBSSxDQUFDLFlBQVksS0FBSyxVQUFVLEVBQUU7WUFDaEUsT0FBTyxFQUFFLENBQUM7U0FDWDtRQUVELElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsa0JBQWtCLElBQUksSUFBSSxDQUFDLENBQUM7WUFDckQsSUFBSSxDQUFDLFlBQVksQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsa0JBQWtCLENBQUM7UUFFNUUsSUFBSSxLQUFLLEdBQUcsU0FBUyxDQUFDO1FBRXRCLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxZQUFZLEVBQUU7WUFDbEMsS0FBSyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQy9DO1FBRUQsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksT0FBTyxLQUFLLEtBQUssV0FBVyxJQUFJLE1BQU0sQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxnQkFBZ0IsRUFBRTtZQUM3RyxJQUFJLEtBQUssQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO2dCQUN0QixPQUFPLEVBQUUsQ0FBQzthQUNYO2lCQUFNO2dCQUNMLEtBQUssR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDbEI7U0FDRjtRQUVELElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxJQUFJLElBQUksRUFBRTtZQUNyQyxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7U0FDMUI7UUFFRCxPQUFPLEtBQUssSUFBSSxFQUFFLENBQUM7SUFDckIsQ0FBQztJQUVEOztPQUVHO0lBQ0ksNENBQVksR0FBbkI7UUFDRSxJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDZCxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUM7U0FDdkI7YUFBTTtZQUNMLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztTQUN0QjtJQUNILENBQUM7SUFFRDs7T0FFRztJQUNJLDBDQUFVLEdBQWpCO1FBQ0UsSUFBTSxrQkFBa0IsR0FBRyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztRQUNyRCw0QkFBWSxrQkFBa0IsRUFBSyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRztJQUN4RCxDQUFDO0lBRU8sa0RBQWtCLEdBQTFCO1FBQ0UsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUU3QixJQUFJLElBQUksQ0FBQyxRQUFRLEtBQUssTUFBTSxFQUFFO1lBQzVCLElBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQ2hDLElBQUksQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUNqQyxDQUFDLENBQUMsQ0FBQztZQUVKLElBQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUM7WUFFbkMsSUFBSSxRQUFRLEdBQUcsT0FBTyxHQUFHLFFBQVEsRUFBRTtnQkFDakMsUUFBUSxHQUFHLEtBQUssQ0FBQzthQUNsQjtpQkFBTTtnQkFDTCxRQUFRLEdBQUcsUUFBUSxDQUFDO2FBQ3JCO1NBQ0Y7UUFFRCxJQUFJLFFBQVEsS0FBSyxRQUFRLEVBQUU7WUFDekIsT0FBTyxFQUFFLENBQUM7U0FDWDthQUFNO1lBQ0wsT0FBTztnQkFDTCxRQUFRLEVBQUUsTUFBTTthQUNqQixDQUFDO1NBQ0g7SUFDSCxDQUFDO0lBRUQ7O09BRUc7SUFDSSx3Q0FBUSxHQUFmO1FBQ0UsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDO0lBQ3hCLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNJLDRDQUFZLEdBQW5CLFVBQW9CLEtBQUs7UUFDdkIsSUFBSSxJQUFJLENBQUMsY0FBYyxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUN4RCxJQUFJLElBQUksQ0FBQyxhQUFhLEtBQUssQ0FBQyxDQUFDLEVBQUU7Z0JBQzdCLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQzthQUN2RDtpQkFBTTtnQkFDTCxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7YUFDckI7U0FDRjthQUFNO1lBQ0wsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1NBQ3JCO1FBRUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNyQixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNJLHlDQUFTLEdBQWhCLFVBQWlCLEtBQUs7UUFDcEIsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQ3BELElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztTQUNqQjtJQUNILENBQUM7SUFFRDs7Ozs7T0FLRztJQUNJLCtDQUFlLEdBQXRCLFVBQXVCLE1BQU0sRUFBRSxVQUFlO1FBQzVDLElBQUksT0FBTyxVQUFVLEtBQUssV0FBVyxFQUFFO1lBQ3JDLElBQUksQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLENBQUM7WUFFNUIsSUFBSSxNQUFNLENBQUMsUUFBUSxFQUFFO2dCQUNuQixJQUFJLE1BQU0sQ0FBQyxRQUFRLENBQUMsZUFBZSxFQUFFO29CQUNuQyxNQUFNLENBQUMsUUFBUSxDQUFDLGVBQWUsRUFBRSxDQUFDO2lCQUNuQztnQkFDRCxJQUFJLE1BQU0sQ0FBQyxRQUFRLENBQUMsY0FBYyxFQUFFO29CQUNsQyxNQUFNLENBQUMsUUFBUSxDQUFDLGNBQWMsRUFBRSxDQUFDO2lCQUNsQzthQUNGO2lCQUFNLElBQUksTUFBTSxDQUFDLGNBQWMsRUFBRTtnQkFDaEMsTUFBTSxDQUFDLGNBQWMsRUFBRSxDQUFDO2FBQ3pCO1NBQ0Y7UUFFRCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFFRDs7T0FFRztJQUNJLDRDQUFZLEdBQW5CO1FBQ0UsSUFBSSxJQUFJLENBQUMsZUFBZSxLQUFLLEtBQUssSUFBSSxJQUFJLENBQUMsY0FBYyxLQUFLLEtBQUssRUFBRTtZQUNuRSxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQztTQUM3QjtRQUVELElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQztRQUMzQyxJQUFJLENBQUMsYUFBYSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQzFCLENBQUM7SUFFRCw2Q0FBYSxHQUFiLFVBQWMsU0FBZ0I7UUFDNUIsSUFBSSxJQUFJLENBQUMsZUFBZSxLQUFLLEtBQUssRUFBRTtZQUNsQyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7U0FDckI7UUFFRCxJQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7UUFFeEMsSUFBSSxTQUFTLEdBQUcsQ0FBQyxFQUFFO1lBQ2pCLElBQUksSUFBSSxDQUFDLGFBQWEsS0FBSyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsYUFBYSxLQUFLLEdBQUcsRUFBRTtnQkFDM0QsSUFBSSxDQUFDLGFBQWEsR0FBRyxDQUFDLENBQUM7YUFDeEI7aUJBQU07Z0JBQ0wsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO2FBQ3RCO1NBQ0Y7YUFBTSxJQUFJLFNBQVMsR0FBRyxDQUFDLEVBQUU7WUFDeEIsSUFBSSxJQUFJLENBQUMsYUFBYSxLQUFLLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxhQUFhLEtBQUssQ0FBQyxFQUFFO2dCQUN6RCxJQUFJLENBQUMsYUFBYSxHQUFHLEdBQUcsQ0FBQzthQUMxQjtpQkFBTTtnQkFDTCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7YUFDdEI7U0FDRjtJQUNILENBQUM7SUFFRDs7T0FFRztJQUNILHVDQUFPLEdBQVAsVUFBUSxLQUFTO1FBQ2YsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFFckIsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBRWhCLEtBQUssR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRWpDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzNCLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3pCLENBQUM7SUFFRDs7T0FFRztJQUNILHNDQUFNLEdBQU4sVUFBTyxLQUFLO1FBQ1YsSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7UUFFdEIsS0FBSyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFakMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDMUIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDeEIsQ0FBQztJQUVELDRDQUFZLEdBQVosVUFBYSxLQUFTO1FBQ3BCLElBQUksT0FBTyxLQUFLLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLFFBQVEsRUFBRTtZQUN0RSxLQUFLLENBQUMsVUFBVSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLEtBQUssQ0FBQztTQUM5RTtRQUVELE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQztJQUVEOzs7O09BSUc7SUFDSSxnREFBZ0IsR0FBdkIsVUFBd0IsRUFBaUI7UUFDdkMsSUFBSSxDQUFDLGdCQUFnQixHQUFHLEVBQUUsQ0FBQztJQUM3QixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNJLGlEQUFpQixHQUF4QixVQUF5QixFQUFpQjtRQUN4QyxJQUFJLENBQUMsaUJBQWlCLEdBQUcsRUFBRSxDQUFDO0lBQzlCLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ksZ0RBQWdCLEdBQXZCLFVBQXdCLFdBQWlCO1FBQ3ZDLElBQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFL0QsSUFBTSxlQUFlLEdBQUcsV0FBVyxDQUFDLE1BQU0sQ0FBQztRQUUzQyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsYUFBYSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ3RDLElBQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQ2pDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQ2pCLENBQUM7WUFFRixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsZUFBZSxFQUFFLENBQUMsRUFBRSxFQUFFO2dCQUN4QyxJQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUNsQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQ2YsQ0FBQztnQkFFRixJQUFJLGFBQWEsS0FBSyxjQUFjLEVBQUU7b0JBQ3BDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO2lCQUMxQjthQUNGO1NBQ0Y7UUFFRCxPQUFPLFdBQVcsQ0FBQztJQUNyQixDQUFDO0lBRU0sOENBQWMsR0FBckIsVUFBc0IsV0FBaUI7UUFDckMsSUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUM7UUFFMUMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLGFBQWEsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUN0QyxJQUFJLFlBQVksR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ25DLElBQUksT0FBTyxZQUFZLEtBQUssUUFBUSxFQUFFO2dCQUNwQyxZQUFZLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsQ0FBQzthQUM1QztZQUVELElBQU0sZUFBZSxHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUM7WUFFM0MsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLGVBQWUsRUFBRSxDQUFDLEVBQUUsRUFBRTtnQkFDeEMsSUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FDbEMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUNmLENBQUM7Z0JBRUYsSUFBSSxZQUFZLEtBQUssY0FBYyxFQUFFO29CQUNuQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztvQkFFekIsTUFBTTtpQkFDUDthQUNGO1NBQ0Y7UUFFRCxPQUFPLFdBQVcsQ0FBQztJQUNyQixDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSSwwQ0FBVSxHQUFqQixVQUFrQixTQUFhLEVBQUUsTUFBZTtRQUM5QyxJQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXZELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDOUIsSUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUU5QixJQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQy9DLElBQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFdEMsSUFBSSxhQUFhLEtBQUssU0FBUyxFQUFFO2dCQUMvQixJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7YUFDNUI7U0FDRjtRQUVELE1BQU0sR0FBRyxPQUFPLE1BQU0sS0FBSyxXQUFXLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO1FBRXZELElBQUksTUFBTSxFQUFFO1lBQ1IsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDakMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQ3hDO1FBRUQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFRDs7OztRQUlJO0lBQ0csMENBQVUsR0FBakIsVUFBa0IsU0FBYTtRQUM3QixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDeEMsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzlDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUVwQixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUVqQyxJQUFJLElBQUksQ0FBQyxtQkFBbUIsRUFBRTtZQUM1QixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7U0FDckI7UUFFRCxJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDZCxJQUFJLElBQUksQ0FBQyxXQUFXLEtBQUssSUFBSSxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUU7Z0JBQ3pFLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztnQkFFbEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7Z0JBQzlCLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUN0QztpQkFBTTtnQkFDTCxPQUFPO2FBQ1I7U0FDRjthQUFNO1lBQ0wsSUFBSSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7WUFFM0IsSUFBSSxDQUFDLFFBQVEsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQzVCLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1NBQ2xDO1FBRUQsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDbEMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFRDs7T0FFRztJQUNJLHdDQUFRLEdBQWY7UUFDRSxJQUFJLElBQUksQ0FBQyxXQUFXLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUN0QyxJQUFJLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxRQUFRLEVBQUUsQ0FBQztTQUN6QzthQUFNLElBQUksSUFBSSxDQUFDLGFBQWEsRUFBRTtZQUM3QixJQUFJLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxRQUFRLEVBQUUsQ0FBQztTQUM3QztJQUNILENBQUM7SUFFRDs7Ozs7T0FLRztJQUNJLDhDQUFjLEdBQXJCLFVBQXNCLFdBQWlCLEVBQUUsSUFBYTtRQUNwRCxJQUFJLElBQUksQ0FBQywwQkFBMEIsRUFBRTtZQUNuQyxXQUFXLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ2pELFdBQVcsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1NBQ2hEO1FBRUQsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7UUFFL0IsSUFBSSxJQUFJLElBQUksT0FBTyxJQUFJLEtBQUssV0FBVyxFQUFFO1lBQ3ZDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztTQUNyQjtRQUVELElBQUksSUFBSSxDQUFDLG1CQUFtQixFQUFFO1lBQzVCLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO2dCQUNqQyxJQUFJLENBQUMsYUFBYSxHQUFHLENBQUMsQ0FBQzthQUN4QjtTQUNGO0lBQ0gsQ0FBQztJQUVEOzs7O09BSUc7SUFDSSx3Q0FBUSxHQUFmLFVBQWdCLFNBQWM7UUFDNUIsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzlDLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUN4QyxPQUFPO0lBQ1QsQ0FBQztJQUVEOztPQUVHO0lBQ0ksNENBQVksR0FBbkI7UUFDRSxJQUFJLElBQUksQ0FBQyxlQUFlLEtBQUssS0FBSyxFQUFFO1lBQ2xDLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDO1NBQzdCO1FBRUQsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUM7SUFDOUIsQ0FBQztJQUVEOztPQUVHO0lBQ0ksMkNBQVcsR0FBbEIsVUFBbUIsV0FBa0I7UUFDbkMsSUFBSSxXQUFXLEtBQUssSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNsQyxJQUFJLENBQUMsU0FBUyxHQUFHLFdBQVcsQ0FBQztZQUU3QixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRTtnQkFDZixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQzthQUN0QjtTQUNGO1FBRUQsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7WUFDekIsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztTQUN2QztRQUVELElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNJLDBDQUFVLEdBQWpCLFVBQWtCLEtBQVM7UUFDekIsSUFBSSxLQUFLLEtBQUssSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUM1QixJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssSUFBSSxJQUFJLENBQUM7WUFDL0IsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUNuRCxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1NBQzlDO0lBQ0gsQ0FBQzs7SUF6eUJRO1FBQVIsS0FBSyxFQUFFO2lFQUF1QztJQUN0QztRQUFSLEtBQUssRUFBRTtzRUFBMkM7SUFDMUM7UUFBUixLQUFLLEVBQUU7NEVBQWtEO0lBQ2pEO1FBQVIsS0FBSyxFQUFFO29FQUF5QztJQUN4QztRQUFSLEtBQUssRUFBRTsrREFBa0Q7SUFDakQ7UUFBUixLQUFLLEVBQUU7MkRBQWlDO0lBQ2hDO1FBQVIsS0FBSyxFQUFFO2dFQUF1QztJQUN0QztRQUFSLEtBQUssRUFBRTswREFBMkI7SUFDMUI7UUFBUixLQUFLLEVBQUU7NERBQXVDO0lBQ3RDO1FBQVIsS0FBSyxFQUFFO3NFQUEyQztJQUMxQztRQUFSLEtBQUssRUFBRTswREFBdUI7SUFDdEI7UUFBUixLQUFLLEVBQUU7MkRBQWlDO0lBQ2hDO1FBQVIsS0FBSyxFQUFFOzZEQUE4QjtJQUM3QjtRQUFSLEtBQUssRUFBRTs4REFBa0M7SUFDakM7UUFBUixLQUFLLEVBQUU7d0RBQThCO0lBQzdCO1FBQVIsS0FBSyxFQUFFO3VEQUF5QjtJQUN4QjtRQUFSLEtBQUssRUFBRTtzRUFBd0M7SUFDdkM7UUFBUixLQUFLLEVBQUU7b0VBQTZDO0lBQzVDO1FBQVIsS0FBSyxFQUFFO21FQUF1RDtJQUN0RDtRQUFSLEtBQUssRUFBRTttRUFBd0M7SUFDdkM7UUFBUixLQUFLLEVBQUU7NkVBQWtEO0lBQ2pEO1FBQVIsS0FBSyxFQUFFO29FQUEyQztJQUMxQztRQUFSLEtBQUssRUFBRTtpRUFBc0M7SUFDckM7UUFBUixLQUFLLEVBQUU7bUVBQWlDO0lBQ2hDO1FBQVIsS0FBSyxFQUFFO3lEQUF3QztJQUN2QztRQUFSLEtBQUssRUFBRTsyREFBa0M7SUFDakM7UUFBUixLQUFLLEVBQUU7OERBQW9DO0lBRzVDO1FBREMsS0FBSyxFQUFFO3NEQVlQO0lBYUQ7UUFEQyxLQUFLLEVBQUU7d0RBY1A7SUFFUztRQUFULE1BQU0sRUFBRTs4REFBNEM7SUFHckQ7UUFEQyxLQUFLLEVBQUU7c0RBS1A7SUFFUztRQUFULE1BQU0sRUFBRTt1REFBK0I7SUFDOUI7UUFBVCxNQUFNLEVBQUU7NERBQW9DO0lBQ25DO1FBQVQsTUFBTSxFQUFFOzJEQUFtQztJQUNsQztRQUFULE1BQU0sRUFBRTt3REFBZ0M7SUFDL0I7UUFBVCxNQUFNLEVBQUU7K0RBQTBDO0lBQ3pDO1FBQVQsTUFBTSxFQUFFOzhEQUFzQztJQUNyQztRQUFULE1BQU0sRUFBRTsrREFBMkM7SUFDMUM7UUFBVCxNQUFNLEVBQUU7OERBQXNDO0lBQ3JDO1FBQVQsTUFBTSxFQUFFOzhEQUFzQztJQUNyQztRQUFULE1BQU0sRUFBRTsrREFBdUM7SUFDdEM7UUFBVCxNQUFNLEVBQUU7NkRBQXFDO0lBUzlDO1FBUEMsU0FBUyxDQUNSLGVBQWUsRUFDZjtZQUNFLElBQUksRUFBSSxVQUFVO1lBQ2xCLE1BQU0sRUFBRSxLQUFLO1NBQ2QsQ0FDRjtnRUFDZ0M7SUFTakM7UUFQQyxTQUFTLENBQ1IsV0FBVyxFQUNYO1lBQ0UsSUFBSSxFQUFJLFVBQVU7WUFDbEIsTUFBTSxFQUFFLEtBQUs7U0FDZCxDQUNGOzREQUM0QjtJQWdIN0I7UUFEQyxZQUFZLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQztxRUFTMUM7SUFsT1UscUJBQXFCO1FBZGpDLFNBQVMsQ0FBQztZQUNULFNBQVMsRUFBRTtnQkFDVDtvQkFDRSxPQUFPLEVBQUUsaUJBQWlCO29CQUMxQixXQUFXLEVBQUUsdUJBQXFCO29CQUNsQyxLQUFLLEVBQUUsSUFBSTtpQkFDWjthQUNGO1lBQ0QsUUFBUSxFQUFLLG1CQUFtQjtZQUloQywrc1BBQTJDOztTQUM1QyxDQUFDO09BQ1cscUJBQXFCLENBMnlCakM7SUFBRCw0QkFBQztDQUFBLEFBM3lCRCxJQTJ5QkM7U0EzeUJZLHFCQUFxQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgRG9DaGVjayxcbiAgSW5wdXQsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyLFxuICBUZW1wbGF0ZVJlZixcbiAgVmlld0NoaWxkLFxuICBIb3N0TGlzdGVuZXIsXG4gIEVsZW1lbnRSZWYsXG4gIEFmdGVyVmlld0NoZWNrZWRcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0NvbnRyb2xWYWx1ZUFjY2Vzc29yLCBOR19WQUxVRV9BQ0NFU1NPUn0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuXG5pbXBvcnQge2Zyb20sIE9ic2VydmFibGUsIFN1YmplY3R9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtmaW5hbGl6ZX0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQge0F1dG9Db21wbGV0ZU9wdGlvbnN9IGZyb20gJy4uL2F1dG8tY29tcGxldGUtb3B0aW9ucy5tb2RlbCc7XG5pbXBvcnQge0F1dG9Db21wbGV0ZVNlcnZpY2V9IGZyb20gJy4uL2F1dG8tY29tcGxldGUuc2VydmljZSc7XG5pbXBvcnQge0F1dG9Db21wbGV0ZVN0eWxlc30gZnJvbSAnLi4vYXV0by1jb21wbGV0ZS1zdHlsZXMubW9kZWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgcHJvdmlkZXJzOiBbXG4gICAge1xuICAgICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gICAgICB1c2VFeGlzdGluZzogQXV0b0NvbXBsZXRlQ29tcG9uZW50LFxuICAgICAgbXVsdGk6IHRydWVcbiAgICB9XG4gIF0sXG4gIHNlbGVjdG9yOiAgICAnaW9uLWF1dG8tY29tcGxldGUnLFxuICBzdHlsZVVybHM6IFtcbiAgICAnLi9hdXRvLWNvbXBsZXRlLmNvbXBvbmVudC5zY3NzJ1xuICBdLFxuICB0ZW1wbGF0ZVVybDogJ2F1dG8tY29tcGxldGUuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIEF1dG9Db21wbGV0ZUNvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0NoZWNrZWQsIENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBEb0NoZWNrIHtcbiAgQElucHV0KCkgcHVibGljIGFsd2F5c1Nob3dMaXN0OmJvb2xlYW4gPSBmYWxzZTtcbiAgQElucHV0KCkgcHVibGljIGF1dG9Gb2N1c1N1Z2dlc3Rpb246Ym9vbGVhbiA9IHRydWU7XG4gIEBJbnB1dCgpIHB1YmxpYyBlbmFibGVCcm93c2VyQXV0b0NvbXBsZXRlOmJvb2xlYW4gPSBmYWxzZTtcbiAgQElucHV0KCkgcHVibGljIGNsZWFySW52YWxpZElucHV0OmJvb2xlYW4gPSB0cnVlO1xuICBASW5wdXQoKSBwdWJsaWMgZGF0YVByb3ZpZGVyOkF1dG9Db21wbGV0ZVNlcnZpY2V8RnVuY3Rpb247XG4gIEBJbnB1dCgpIHB1YmxpYyBkaXNhYmxlZDpib29sZWFuID0gZmFsc2U7XG4gIEBJbnB1dCgpIHB1YmxpYyBlbXB0eVRlbXBsYXRlOlRlbXBsYXRlUmVmPGFueT47XG4gIEBJbnB1dCgpIHB1YmxpYyBleGNsdWRlOmFueVtdID0gW107XG4gIEBJbnB1dCgpIHB1YmxpYyBmcm9udEljb246ZmFsc2V8c3RyaW5nID0gZmFsc2U7XG4gIEBJbnB1dCgpIHB1YmxpYyBoaWRlTGlzdE9uU2VsZWN0aW9uOmJvb2xlYW4gPSB0cnVlO1xuICBASW5wdXQoKSBwdWJsaWMga2V5d29yZDpzdHJpbmc7XG4gIEBJbnB1dCgpIHB1YmxpYyBsb2NhdGlvbjpzdHJpbmcgPSAnYXV0byc7XG4gIEBJbnB1dCgpIHB1YmxpYyBtYXhSZXN1bHRzOm51bWJlciA9IDg7XG4gIEBJbnB1dCgpIHB1YmxpYyBtYXhTZWxlY3RlZDpudW1iZXIgPSBudWxsO1xuICBASW5wdXQoKSBwdWJsaWMgbXVsdGk6Ym9vbGVhbiA9IGZhbHNlO1xuICBASW5wdXQoKSBwdWJsaWMgbmFtZTpzdHJpbmcgPSAnJztcbiAgQElucHV0KCkgcHVibGljIHJlbW92ZUJ1dHRvbkNsYXNzZXM6c3RyaW5nID0gJyc7XG4gIEBJbnB1dCgpIHB1YmxpYyByZW1vdmVCdXR0b25Db2xvcjpzdHJpbmcgPSAncHJpbWFyeSc7XG4gIEBJbnB1dCgpIHB1YmxpYyByZW1vdmVCdXR0b25JY29uOnN0cmluZ3xmYWxzZSA9ICdjbG9zZS1jaXJjbGUnO1xuICBASW5wdXQoKSBwdWJsaWMgcmVtb3ZlQnV0dG9uU2xvdDpzdHJpbmcgPSAnZW5kJztcbiAgQElucHV0KCkgcHVibGljIHJlbW92ZUR1cGxpY2F0ZVN1Z2dlc3Rpb25zOmJvb2xlYW4gPSB0cnVlO1xuICBASW5wdXQoKSBwdWJsaWMgc2VsZWN0aW9uVGVtcGxhdGU6VGVtcGxhdGVSZWY8YW55PjtcbiAgQElucHV0KCkgcHVibGljIHNlbGVjdE9uVGFiT3V0OmJvb2xlYW4gPSB0cnVlO1xuICBASW5wdXQoKSBwdWJsaWMgc2hvd1Jlc3VsdHNGaXJzdDpib29sZWFuO1xuICBASW5wdXQoKSBwdWJsaWMgc3R5bGVzID0gbmV3IEF1dG9Db21wbGV0ZVN0eWxlcztcbiAgQElucHV0KCkgcHVibGljIHRlbXBsYXRlOlRlbXBsYXRlUmVmPGFueT47XG4gIEBJbnB1dCgpIHB1YmxpYyB1c2VJb25JbnB1dDpib29sZWFuID0gZmFsc2U7XG5cbiAgQElucHV0KClcbiAgZ2V0IG1vZGVsKCk6YW55fGFueVtdIHtcbiAgICBsZXQgbW9kZWwgPSB0aGlzLnNlbGVjdGVkO1xuICAgIGlmICghdGhpcy5tdWx0aSAmJiB0eXBlb2YgdGhpcy5zZWxlY3RlZC5sZW5ndGggIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBpZiAodGhpcy5zZWxlY3RlZC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgbW9kZWwgPSBudWxsO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbW9kZWwgPSB0aGlzLnNlbGVjdGVkWzBdO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBtb2RlbDtcbiAgfVxuXG4gIHNldCBtb2RlbChzZWxlY3RlZDphbnl8YW55W10pIHtcbiAgICBpZiAodHlwZW9mIHNlbGVjdGVkICE9PSAndW5kZWZpbmVkJyAmJiBzZWxlY3RlZCAhPT0gbnVsbCkge1xuICAgICAgdGhpcy5zZWxlY3RlZCA9IHNlbGVjdGVkO1xuXG4gICAgICB0aGlzLmtleXdvcmQgPSB0aGlzLmdldExhYmVsKHNlbGVjdGVkKVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBhdXRvY29tcGxldGVPcHRpb25zOkF1dG9Db21wbGV0ZU9wdGlvbnMgPSBuZXcgQXV0b0NvbXBsZXRlT3B0aW9ucygpO1xuXG4gIEBJbnB1dCgpXG4gIHNldCBvcHRpb25zKG9wdGlvbnM6QXV0b0NvbXBsZXRlT3B0aW9uc3xhbnkpIHtcbiAgICB0aGlzLmF1dG9jb21wbGV0ZU9wdGlvbnMgPSBuZXcgQXV0b0NvbXBsZXRlT3B0aW9ucygpO1xuXG4gICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHRoaXMuYXV0b2NvbXBsZXRlT3B0aW9ucyk7XG5cbiAgICBjb25zdCBrZXlzTGVuZ3RoID0ga2V5cy5sZW5ndGg7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXlzTGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGtleSA9IGtleXNbaV07XG5cbiAgICAgIGlmICh0eXBlb2Ygb3B0aW9uc1trZXldICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICB0aGlzLmF1dG9jb21wbGV0ZU9wdGlvbnNba2V5XSA9IG9wdGlvbnNba2V5XTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBAT3V0cHV0KCkgcHVibGljIG1vZGVsQ2hhbmdlOkV2ZW50RW1pdHRlcjxhbnl8YW55W10+O1xuXG4gIEBJbnB1dCgpXG4gIHNldCBlYWdlcihlYWdlcjpib29sZWFuKSB7XG4gICAgaWYgKGVhZ2VyKSB7XG4gICAgICB0aGlzLmdldEl0ZW1zKG51bGwsIGZhbHNlKTtcbiAgICB9XG4gIH1cblxuICBAT3V0cHV0KCkgcHVibGljIGJsdXI6RXZlbnRFbWl0dGVyPGFueT47XG4gIEBPdXRwdXQoKSBwdWJsaWMgYXV0b0ZvY3VzOkV2ZW50RW1pdHRlcjxhbnk+O1xuICBAT3V0cHV0KCkgcHVibGljIGF1dG9CbHVyOkV2ZW50RW1pdHRlcjxhbnk+O1xuICBAT3V0cHV0KCkgcHVibGljIGZvY3VzOkV2ZW50RW1pdHRlcjxhbnk+O1xuICBAT3V0cHV0KCkgcHVibGljIGlvbkF1dG9JbnB1dDpFdmVudEVtaXR0ZXI8c3RyaW5nPjtcbiAgQE91dHB1dCgpIHB1YmxpYyBpdGVtc0NoYW5nZTpFdmVudEVtaXR0ZXI8YW55PjtcbiAgQE91dHB1dCgpIHB1YmxpYyBpdGVtc0NsZWFyZWQ6RXZlbnRFbWl0dGVyPGJvb2xlYW4+O1xuICBAT3V0cHV0KCkgcHVibGljIGl0ZW1zSGlkZGVuOkV2ZW50RW1pdHRlcjxhbnk+O1xuICBAT3V0cHV0KCkgcHVibGljIGl0ZW1SZW1vdmVkOkV2ZW50RW1pdHRlcjxhbnk+O1xuICBAT3V0cHV0KCkgcHVibGljIGl0ZW1TZWxlY3RlZDpFdmVudEVtaXR0ZXI8YW55PjtcbiAgQE91dHB1dCgpIHB1YmxpYyBpdGVtc1Nob3duOkV2ZW50RW1pdHRlcjxhbnk+O1xuXG4gIEBWaWV3Q2hpbGQoXG4gICAgJ3NlYXJjaGJhckVsZW0nLFxuICAgIHtcbiAgICAgIHJlYWQ6ICAgRWxlbWVudFJlZixcbiAgICAgIHN0YXRpYzogZmFsc2VcbiAgICB9XG4gIClcbiAgcHJpdmF0ZSBzZWFyY2hiYXJFbGVtOkVsZW1lbnRSZWY7XG5cbiAgQFZpZXdDaGlsZChcbiAgICAnaW5wdXRFbGVtJyxcbiAgICB7XG4gICAgICByZWFkOiAgIEVsZW1lbnRSZWYsXG4gICAgICBzdGF0aWM6IGZhbHNlXG4gICAgfVxuICApXG4gIHByaXZhdGUgaW5wdXRFbGVtOkVsZW1lbnRSZWY7XG5cbiAgcHJpdmF0ZSBvblRvdWNoZWRDYWxsYmFjazpGdW5jdGlvbnxmYWxzZSA9IGZhbHNlO1xuICBwcml2YXRlIG9uQ2hhbmdlQ2FsbGJhY2s6RnVuY3Rpb258ZmFsc2UgPSBmYWxzZTtcblxuICBwdWJsaWMgZGVmYXVsdE9wdHM6QXV0b0NvbXBsZXRlT3B0aW9ucztcbiAgcHVibGljIGhhc0ZvY3VzOmJvb2xlYW4gPSBmYWxzZTtcbiAgcHVibGljIGlzTG9hZGluZzpib29sZWFuID0gZmFsc2U7XG4gIHB1YmxpYyBmb2N1c2VkT3B0aW9uOm51bWJlciA9IC0xO1xuICBwdWJsaWMgZm9ybVZhbHVlOmFueTtcbiAgcHVibGljIHNlbGVjdGVkOmFueXxhbnlbXTtcbiAgcHVibGljIHNlbGVjdGlvbjphbnk7XG4gIHB1YmxpYyBzaG93U3VnZ2VzdGlvbnM6Ym9vbGVhbiA9IGZhbHNlO1xuICBwdWJsaWMgc3VnZ2VzdGlvbnM6YW55W107XG4gIHB1YmxpYyBwcm9taXNlO1xuXG4gIHB1YmxpYyBnZXQgc2hvd0xpc3QoKTpib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5zaG93U3VnZ2VzdGlvbnM7XG4gIH1cblxuICBwdWJsaWMgc2V0IHNob3dMaXN0KHZhbHVlOmJvb2xlYW4pIHtcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnNob3dTdWdnZXN0aW9ucyA9PT0gdmFsdWUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLnNob3dTdWdnZXN0aW9ucyA9IHZhbHVlID09PSB0cnVlO1xuICAgIHRoaXMuc2hvd0xpc3RDaGFuZ2VkID0gdHJ1ZTtcbiAgfVxuXG4gIHByaXZhdGUgc2hvd0xpc3RDaGFuZ2VkOmJvb2xlYW4gPSBmYWxzZTtcblxuICAvKipcbiAgICogQ3JlYXRlIGEgbmV3IGluc3RhbmNlXG4gICAqL1xuICBwdWJsaWMgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5hdXRvQmx1ciA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICAgIHRoaXMuYXV0b0ZvY3VzID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gICAgdGhpcy5ibHVyID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gICAgdGhpcy5mb2N1cyA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICAgIHRoaXMuaW9uQXV0b0lucHV0ID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XG4gICAgdGhpcy5pdGVtc0NoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICAgIHRoaXMuaXRlbXNDbGVhcmVkID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xuICAgIHRoaXMuaXRlbXNIaWRkZW4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgICB0aGlzLml0ZW1SZW1vdmVkID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gICAgdGhpcy5pdGVtU2VsZWN0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgICB0aGlzLml0ZW1zU2hvd24gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgICB0aGlzLm1vZGVsQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxhbnl8YW55W10+KCk7XG5cbiAgICB0aGlzLmtleXdvcmQgPSAnJztcbiAgICB0aGlzLnN1Z2dlc3Rpb25zID0gW107XG5cbiAgICB0aGlzLmF1dG9jb21wbGV0ZU9wdGlvbnMgPSBuZXcgQXV0b0NvbXBsZXRlT3B0aW9ucygpO1xuXG4gICAgdGhpcy5kZWZhdWx0T3B0cyA9IG5ldyBBdXRvQ29tcGxldGVPcHRpb25zKCk7XG5cbiAgICB0aGlzLnNlbGVjdGVkID0gW107XG4gIH1cblxuICAvKipcbiAgICpcbiAgICovXG4gIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpOnZvaWQge1xuICAgIGlmICh0aGlzLnNob3dMaXN0Q2hhbmdlZCkge1xuICAgICAgdGhpcy5zaG93TGlzdENoYW5nZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMuc2hvd1N1Z2dlc3Rpb25zID8gdGhpcy5pdGVtc1Nob3duLmVtaXQoKSA6IHRoaXMuaXRlbXNIaWRkZW4uZW1pdCgpO1xuICAgIH1cbiAgfVxuXG4gIG5nRG9DaGVjaygpOnZvaWQge1xuICAgIGlmICghdGhpcy5oYXNGb2N1cykge1xuICAgICAgaWYgKHRoaXMuY2xlYXJJbnZhbGlkSW5wdXQgJiYgKHRoaXMuc2VsZWN0ZWQgPT09IG51bGwgfHwgdGhpcy5tdWx0aSkpIHtcbiAgICAgICAgaWYgKHRoaXMua2V5d29yZCAhPT0gJycpIHtcbiAgICAgICAgICB0aGlzLmtleXdvcmQgPSAnJztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmlucHV0RWxlbSAmJiB0aGlzLmlucHV0RWxlbS5uYXRpdmVFbGVtZW50KSB7XG4gICAgICAgICAgaWYgKHRoaXMuaW5wdXRFbGVtLm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW4gJiYgdGhpcy5pbnB1dEVsZW0ubmF0aXZlRWxlbWVudC5jaGlsZHJlbi5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlucHV0RWxlbS5uYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdLmNoaWxkcmVuICYmIHRoaXMuaW5wdXRFbGVtLm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW5bMF0uY2hpbGRyZW4ubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgICAgIGlmICh0aGlzLmlucHV0RWxlbS5uYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdLmNoaWxkcmVuWzBdLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dEVsZW0ubmF0aXZlRWxlbWVudC5jaGlsZHJlblswXS5jaGlsZHJlblswXS52YWx1ZSA9ICcnO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuc2VhcmNoYmFyRWxlbSAmJiB0aGlzLnNlYXJjaGJhckVsZW0ubmF0aXZlRWxlbWVudCkge1xuICAgICAgICAgIGlmICh0aGlzLnNlYXJjaGJhckVsZW0ubmF0aXZlRWxlbWVudC5jaGlsZHJlbiAmJiB0aGlzLnNlYXJjaGJhckVsZW0ubmF0aXZlRWxlbWVudC5jaGlsZHJlbi5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnNlYXJjaGJhckVsZW0ubmF0aXZlRWxlbWVudC5jaGlsZHJlblswXS5jaGlsZHJlbikge1xuICAgICAgICAgICAgICBpZiAodGhpcy5zZWFyY2hiYXJFbGVtLm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW5bMF0uY2hpbGRyZW4ubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VhcmNoYmFyRWxlbS5uYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdLmNoaWxkcmVuWzBdLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaGJhckVsZW0ubmF0aXZlRWxlbWVudC5jaGlsZHJlblswXS5jaGlsZHJlblswXS52YWx1ZSA9ICcnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgZG9jdW1lbnQgY2xpY2tcbiAgICpcbiAgICogQHBhcmFtIGV2ZW50XG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBASG9zdExpc3RlbmVyKCdkb2N1bWVudDpjbGljaycsIFsnJGV2ZW50J10pXG4gIHB1YmxpYyBkb2N1bWVudENsaWNrSGFuZGxlcihldmVudDpFdmVudCk6dm9pZCB7XG4gICAgaWYgKFxuICAgICAgKHRoaXMuc2VhcmNoYmFyRWxlbSAmJiB0aGlzLnNlYXJjaGJhckVsZW0ubmF0aXZlRWxlbWVudCAmJiAhdGhpcy5zZWFyY2hiYXJFbGVtLm5hdGl2ZUVsZW1lbnQuY29udGFpbnMoPHN0cmluZz48dW5rbm93bj5ldmVudC50YXJnZXQpKVxuICAgICAgfHxcbiAgICAgICghdGhpcy5pbnB1dEVsZW0gJiYgdGhpcy5pbnB1dEVsZW0ubmF0aXZlRWxlbWVudCAmJiB0aGlzLmlucHV0RWxlbS5uYXRpdmVFbGVtZW50LmNvbnRhaW5zKDxzdHJpbmc+PHVua25vd24+ZXZlbnQudGFyZ2V0KSlcbiAgICApIHtcbiAgICAgIHRoaXMuaGlkZUl0ZW1MaXN0KCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCB2YWx1ZSBmcm9tIGZvcm1cbiAgICpcbiAgICogQHBhcmFtIHNlbGVjdGlvblxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgcHVibGljIGdldEZvcm1WYWx1ZShzZWxlY3Rpb246YW55KTphbnkge1xuICAgIGlmIChzZWxlY3Rpb24gPT0gbnVsbCB8fCB0eXBlb2YgdGhpcy5kYXRhUHJvdmlkZXIgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGxldCBhdHRyID0gdGhpcy5kYXRhUHJvdmlkZXIuZm9ybVZhbHVlQXR0cmlidXRlID09IG51bGwgP1xuICAgICAgICB0aGlzLmRhdGFQcm92aWRlci5sYWJlbEF0dHJpYnV0ZSA6IHRoaXMuZGF0YVByb3ZpZGVyLmZvcm1WYWx1ZUF0dHJpYnV0ZTtcblxuICAgIGlmICh0eXBlb2Ygc2VsZWN0aW9uID09PSAnb2JqZWN0JyAmJiBhdHRyKSB7XG4gICAgICByZXR1cm4gc2VsZWN0aW9uW2F0dHJdO1xuICAgIH1cblxuICAgIHJldHVybiBzZWxlY3Rpb247XG4gIH1cblxuICAvKipcbiAgICogR2V0IGVsZW1lbnQncyBwb3NpdGlvbiBvbiBzY3JlZW5cbiAgICpcbiAgICogQHBhcmFtIGVsXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwcml2YXRlIF9nZXRQb3NpdGlvbihlbCk6YW55IHtcbiAgICBsZXQgeFBvcyA9IDA7XG4gICAgbGV0IHlQb3MgPSAwO1xuXG4gICAgd2hpbGUgKGVsKSB7XG4gICAgICBpZiAoZWwudGFnTmFtZSA9PT0gJ0JPRFknKSB7XG4gICAgICAgIGNvbnN0IHhTY3JvbGwgPSBlbC5zY3JvbGxMZWZ0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0O1xuICAgICAgICBjb25zdCB5U2Nyb2xsID0gZWwuc2Nyb2xsVG9wIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3A7XG5cbiAgICAgICAgeFBvcyArPSAoZWwub2Zmc2V0TGVmdCAtIHhTY3JvbGwgKyBlbC5jbGllbnRMZWZ0KTtcbiAgICAgICAgeVBvcyArPSAoZWwub2Zmc2V0VG9wIC0geVNjcm9sbCArIGVsLmNsaWVudFRvcCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB4UG9zICs9IChlbC5vZmZzZXRMZWZ0IC0gZWwuc2Nyb2xsTGVmdCArIGVsLmNsaWVudExlZnQpO1xuICAgICAgICB5UG9zICs9IChlbC5vZmZzZXRUb3AgLSBlbC5zY3JvbGxUb3AgKyBlbC5jbGllbnRUb3ApO1xuICAgICAgfVxuXG4gICAgICBlbCA9IGVsLm9mZnNldFBhcmVudDtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHg6IHhQb3MsXG4gICAgICB5OiB5UG9zXG4gICAgfTtcbiAgfVxuXG4gIGNsaWNrQ2xlYXIoKTp2b2lkIHtcbiAgICB0aGlzLmNsZWFyVmFsdWUodHJ1ZSk7XG5cbiAgICB0aGlzLml0ZW1zQ2xlYXJlZC5lbWl0KHRydWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFyIGN1cnJlbnQgaW5wdXQgdmFsdWVcbiAgICpcbiAgICogQHBhcmFtIGhpZGVJdGVtTGlzdFxuICAgKi9cbiAgcHVibGljIGNsZWFyVmFsdWUoaGlkZUl0ZW1MaXN0OmJvb2xlYW4gPSBmYWxzZSk6dm9pZCB7XG4gICAgdGhpcy5rZXl3b3JkID0gJyc7XG4gICAgdGhpcy5zZWxlY3Rpb24gPSBudWxsO1xuICAgIHRoaXMuZm9ybVZhbHVlID0gbnVsbDtcblxuICAgIGlmIChoaWRlSXRlbUxpc3QpIHtcbiAgICAgIHRoaXMuaGlkZUl0ZW1MaXN0KCk7XG4gICAgfVxuXG4gICAgdGhpcy5mb2N1c2VkT3B0aW9uID0gLTE7XG5cbiAgICByZXR1cm47XG4gIH1cblxuICAvKipcbiAgICogR2V0IGl0ZW1zIGZvciBhdXRvLWNvbXBsZXRlXG4gICAqXG4gICAqIEBwYXJhbSBldmVudFxuICAgKiBAcGFyYW0gc2hvd1xuICAgKi9cbiAgcHVibGljIGdldEl0ZW1zKGV2ZW50Pywgc2hvdz86Ym9vbGVhbik6dm9pZCB7XG4gICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlO1xuXG4gICAgaWYgKHRoaXMucHJvbWlzZSkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucHJvbWlzZSk7XG4gICAgfVxuXG4gICAgdGhpcy5wcm9taXNlID0gc2V0VGltZW91dChcbiAgICAgICgpID0+IHtcbiAgICAgICAgaWYgKGV2ZW50KSB7XG4gICAgICAgICAgdGhpcy5rZXl3b3JkID0gZXZlbnQuZGV0YWlsLnRhcmdldC52YWx1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCByZXN1bHQ7XG5cbiAgICAgICAgaWYgKHRoaXMuc2hvd1Jlc3VsdHNGaXJzdCAmJiB0aGlzLmtleXdvcmQudHJpbSgpID09PSAnJykge1xuICAgICAgICAgIHRoaXMua2V5d29yZCA9ICcnO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmRhdGFQcm92aWRlciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIHJlc3VsdCA9IHRoaXMuZGF0YVByb3ZpZGVyKHRoaXMua2V5d29yZCk7XG5cbiAgICAgICAgICB0aGlzLnNldFN1Z2dlc3Rpb25zKHJlc3VsdCwgc2hvdyk7XG5cbiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc3VsdCA9IHRoaXMuZGF0YVByb3ZpZGVyLmdldFJlc3VsdHModGhpcy5rZXl3b3JkKTtcblxuICAgICAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBTdWJqZWN0KSB7XG4gICAgICAgICAgICByZXN1bHQgPSByZXN1bHQuYXNPYnNlcnZhYmxlKCk7XG4gICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBQcm9taXNlKSB7XG4gICAgICAgICAgICByZXN1bHQgPSBmcm9tKHJlc3VsdCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHJlc3VsdCBpbnN0YW5jZW9mIE9ic2VydmFibGUpIHtcbiAgICAgICAgICAgIHJlc3VsdC5waXBlKFxuICAgICAgICAgICAgICAgIGZpbmFsaXplKFxuICAgICAgICAgICAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgIChyZXN1bHRzOiBhbnlbXSkgPT4ge1xuICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdWdnZXN0aW9ucyhyZXN1bHRzLCBzaG93KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIChlcnJvcjogYW55KSA9PiBjb25zb2xlLmVycm9yKGVycm9yKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZXRTdWdnZXN0aW9ucyhyZXN1bHQsIHNob3cpO1xuXG4gICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuaW9uQXV0b0lucHV0LmVtaXQodGhpcy5rZXl3b3JkKTtcbiAgICAgIH0sXG4gICAgICB0aGlzLmF1dG9jb21wbGV0ZU9wdGlvbnMuZGVib3VuY2VcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbiBpdGVtJ3MgbGFiZWxcbiAgICpcbiAgICogQHBhcmFtIHNlbGVjdGlvblxuICAgKi9cbiAgcHVibGljIGdldExhYmVsKHNlbGVjdGlvbjphbnl8YW55W10pOnN0cmluZyB7XG4gICAgaWYgKHNlbGVjdGlvbiA9PSBudWxsIHx8IHR5cGVvZiB0aGlzLmRhdGFQcm92aWRlciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgcmV0dXJuICcnO1xuICAgIH1cblxuICAgIGxldCBhdHRyID0gdGhpcy5kYXRhUHJvdmlkZXIuZm9ybVZhbHVlQXR0cmlidXRlID09IG51bGwgP1xuICAgICAgICB0aGlzLmRhdGFQcm92aWRlci5sYWJlbEF0dHJpYnV0ZSA6IHRoaXMuZGF0YVByb3ZpZGVyLmZvcm1WYWx1ZUF0dHJpYnV0ZTtcblxuICAgIGxldCB2YWx1ZSA9IHNlbGVjdGlvbjtcblxuICAgIGlmICh0aGlzLmRhdGFQcm92aWRlci5nZXRJdGVtTGFiZWwpIHtcbiAgICAgIHZhbHVlID0gdGhpcy5kYXRhUHJvdmlkZXIuZ2V0SXRlbUxhYmVsKHZhbHVlKTtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMubXVsdGkgJiYgdHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsdWUpID09PSAnW29iamVjdCBBcnJheV0nKSB7XG4gICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiAnJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhbHVlID0gdmFsdWVbMF07XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgYXR0cikge1xuICAgICAgcmV0dXJuIHZhbHVlW2F0dHJdIHx8ICcnO1xuICAgIH1cblxuICAgIHJldHVybiB2YWx1ZSB8fCAnJztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCBzZWxlY3Rpb25cbiAgICovXG4gIHB1YmxpYyBnZXRTZWxlY3Rpb24oKTphbnl8YW55W10ge1xuICAgIGlmICh0aGlzLm11bHRpKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb247XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgbWVudSBzdHlsZVxuICAgKi9cbiAgcHVibGljIGxpc3RTdHlsZXMoKTphbnkge1xuICAgIGNvbnN0IGxpc3RMb2NhdGlvblN0eWxlcyA9IHRoaXMubGlzdExvY2F0aW9uU3R5bGVzKCk7XG4gICAgcmV0dXJuIHsgLi4ubGlzdExvY2F0aW9uU3R5bGVzLCAuLi50aGlzLnN0eWxlcy5saXN0IH07XG4gIH1cblxuICBwcml2YXRlIGxpc3RMb2NhdGlvblN0eWxlcygpOmFueSB7XG4gICAgbGV0IGxvY2F0aW9uID0gdGhpcy5sb2NhdGlvbjtcblxuICAgIGlmICh0aGlzLmxvY2F0aW9uID09PSAnYXV0bycpIHtcbiAgICAgIGNvbnN0IGVsZW1lbnRZID0gdGhpcy5fZ2V0UG9zaXRpb24oXG4gICAgICAgIHRoaXMuc2VhcmNoYmFyRWxlbS5uYXRpdmVFbGVtZW50XG4gICAgICApLnk7XG5cbiAgICAgIGNvbnN0IHdpbmRvd1kgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG5cbiAgICAgIGlmIChlbGVtZW50WSA+IHdpbmRvd1kgLSBlbGVtZW50WSkge1xuICAgICAgICBsb2NhdGlvbiA9ICd0b3AnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9jYXRpb24gPSAnYm90dG9tJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAobG9jYXRpb24gPT09ICdib3R0b20nKSB7XG4gICAgICByZXR1cm4ge307XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgICdib3R0b20nOiAnMzdweCdcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IGlucHV0IHZhbHVlXG4gICAqL1xuICBwdWJsaWMgZ2V0VmFsdWUoKTphbnkge1xuICAgIHJldHVybiB0aGlzLmZvcm1WYWx1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGVzIHRhYiBrZXkgcHJlc3MuXG4gICAqIElmIGBzZWxlY3RPblRhYk91dGAgaXMgYHRydWVgLCB3aWxsIHNlbGVjdCBjdXJyZW50bHkgZm9jdXNlZCBpdGVtXG4gICAqIFxuICAgKiBAcGFyYW0gZXZlbnRcbiAgICovXG4gIHB1YmxpYyBoYW5kbGVUYWJPdXQoZXZlbnQpOnZvaWQge1xuICAgIGlmICh0aGlzLnNlbGVjdE9uVGFiT3V0ICYmIHRoaXMuc3VnZ2VzdGlvbnMubGVuZ3RoICE9PSAwKSB7XG4gICAgICBpZiAodGhpcy5mb2N1c2VkT3B0aW9uICE9PSAtMSkge1xuICAgICAgICB0aGlzLnNlbGVjdEl0ZW0odGhpcy5zdWdnZXN0aW9uc1t0aGlzLmZvY3VzZWRPcHRpb25dKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuaGlkZUl0ZW1MaXN0KCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaGlkZUl0ZW1MaXN0KCk7XG4gICAgfVxuXG4gICAgdGhpcy5vbkJsdXIoZXZlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSB0YXBcbiAgICpcbiAgICogQHBhcmFtIGV2ZW50XG4gICAqL1xuICBwdWJsaWMgaGFuZGxlVGFwKGV2ZW50KTp2b2lkIHtcbiAgICBpZiAodGhpcy5zaG93UmVzdWx0c0ZpcnN0IHx8IHRoaXMua2V5d29yZC5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLmdldEl0ZW1zKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSB0YXAgd2hlbiBzZWxlY3RpbmcgYW4gaXRlbVxuICAgKlxuICAgKiBAcGFyYW0gJGV2ZW50XG4gICAqIEBwYXJhbSBzdWdnZXN0aW9uXG4gICAqL1xuICBwdWJsaWMgaGFuZGxlU2VsZWN0VGFwKCRldmVudCwgc3VnZ2VzdGlvbj86YW55KTpmYWxzZSB7XG4gICAgaWYgKHR5cGVvZiBzdWdnZXN0aW9uICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgdGhpcy5zZWxlY3RJdGVtKHN1Z2dlc3Rpb24pO1xuXG4gICAgICBpZiAoJGV2ZW50LnNyY0V2ZW50KSB7XG4gICAgICAgIGlmICgkZXZlbnQuc3JjRXZlbnQuc3RvcFByb3BhZ2F0aW9uKSB7XG4gICAgICAgICAgJGV2ZW50LnNyY0V2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIGlmICgkZXZlbnQuc3JjRXZlbnQucHJldmVudERlZmF1bHQpIHtcbiAgICAgICAgICAkZXZlbnQuc3JjRXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICgkZXZlbnQucHJldmVudERlZmF1bHQpIHtcbiAgICAgICAgJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIEhpZGUgaXRlbSBsaXN0XG4gICAqL1xuICBwdWJsaWMgaGlkZUl0ZW1MaXN0KCk6dm9pZCB7XG4gICAgaWYgKHRoaXMuc2hvd1N1Z2dlc3Rpb25zID09PSBmYWxzZSAmJiB0aGlzLmFsd2F5c1Nob3dMaXN0ID09PSBmYWxzZSkge1xuICAgICAgdGhpcy5zaG93TGlzdENoYW5nZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIHRoaXMuc2hvd1N1Z2dlc3Rpb25zID0gdGhpcy5hbHdheXNTaG93TGlzdDtcbiAgICB0aGlzLmZvY3VzZWRPcHRpb24gPSAtMTtcbiAgfVxuXG4gIGhpZ2hsaWdodEl0ZW0oZGlyZWN0aW9uOm51bWJlcik6dm9pZCB7XG4gICAgaWYgKHRoaXMuc2hvd1N1Z2dlc3Rpb25zID09PSBmYWxzZSkge1xuICAgICAgdGhpcy5zaG93SXRlbUxpc3QoKTtcbiAgICB9XG5cbiAgICBjb25zdCBtYXggPSB0aGlzLnN1Z2dlc3Rpb25zLmxlbmd0aCAtIDE7XG5cbiAgICBpZiAoZGlyZWN0aW9uIDwgMCkge1xuICAgICAgaWYgKHRoaXMuZm9jdXNlZE9wdGlvbiA9PT0gLTEgfHwgdGhpcy5mb2N1c2VkT3B0aW9uID09PSBtYXgpIHtcbiAgICAgICAgdGhpcy5mb2N1c2VkT3B0aW9uID0gMDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZm9jdXNlZE9wdGlvbisrO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID4gMCkge1xuICAgICAgaWYgKHRoaXMuZm9jdXNlZE9wdGlvbiA9PT0gLTEgfHwgdGhpcy5mb2N1c2VkT3B0aW9uID09PSAwKSB7XG4gICAgICAgIHRoaXMuZm9jdXNlZE9wdGlvbiA9IG1heDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZm9jdXNlZE9wdGlvbi0tO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBGaXJlZCB3aGVuIHRoZSBpbnB1dCBmb2N1c2VkXG4gICAqL1xuICBvbkZvY3VzKGV2ZW50OmFueSk6dm9pZCB7XG4gICAgdGhpcy5oYXNGb2N1cyA9IHRydWU7XG5cbiAgICB0aGlzLmdldEl0ZW1zKCk7XG5cbiAgICBldmVudCA9IHRoaXMuX3JlZmxlY3ROYW1lKGV2ZW50KTtcblxuICAgIHRoaXMuYXV0b0ZvY3VzLmVtaXQoZXZlbnQpO1xuICAgIHRoaXMuZm9jdXMuZW1pdChldmVudCk7XG4gIH1cblxuICAvKipcbiAgICogRmlyZWQgd2hlbiB0aGUgaW5wdXQgZm9jdXNlZFxuICAgKi9cbiAgb25CbHVyKGV2ZW50KTp2b2lkIHtcbiAgICB0aGlzLmhhc0ZvY3VzID0gZmFsc2U7XG5cbiAgICBldmVudCA9IHRoaXMuX3JlZmxlY3ROYW1lKGV2ZW50KTtcblxuICAgIHRoaXMuYXV0b0JsdXIuZW1pdChldmVudCk7XG4gICAgdGhpcy5ibHVyLmVtaXQoZXZlbnQpO1xuICB9XG5cbiAgX3JlZmxlY3ROYW1lKGV2ZW50OmFueSk6YW55IHtcbiAgICBpZiAodHlwZW9mIGV2ZW50LnNyY0VsZW1lbnQuYXR0cmlidXRlc1snbmctcmVmbGVjdC1uYW1lJ10gPT09ICdvYmplY3QnKSB7XG4gICAgICBldmVudC5zcmNFbGVtZW50Lm5hbWUgPSBldmVudC5zcmNFbGVtZW50LmF0dHJpYnV0ZXNbJ25nLXJlZmxlY3QtbmFtZSddLnZhbHVlO1xuICAgIH1cblxuICAgIHJldHVybiBldmVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWdpc3RlciBvbkNoYW5nZUNhbGxiYWNrXG4gICAqXG4gICAqIEBwYXJhbSBmblxuICAgKi9cbiAgcHVibGljIHJlZ2lzdGVyT25DaGFuZ2UoZm46RnVuY3Rpb258ZmFsc2UpOnZvaWQge1xuICAgIHRoaXMub25DaGFuZ2VDYWxsYmFjayA9IGZuO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlZ2lzdGVyIG9uVG91Y2hlZENhbGxiYWNrXG4gICAqXG4gICAqIEBwYXJhbSBmblxuICAgKi9cbiAgcHVibGljIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOkZ1bmN0aW9ufGZhbHNlKTp2b2lkIHtcbiAgICB0aGlzLm9uVG91Y2hlZENhbGxiYWNrID0gZm47XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIGFscmVhZHkgc2VsZWN0ZWQgc3VnZ2VzdGlvbnNcbiAgICpcbiAgICogQHBhcmFtIHN1Z2dlc3Rpb25zXG4gICAqL1xuICBwdWJsaWMgcmVtb3ZlRHVwbGljYXRlcyhzdWdnZXN0aW9uczphbnlbXSk6YW55W10ge1xuICAgIGNvbnN0IHNlbGVjdGVkQ291bnQgPSB0aGlzLnNlbGVjdGVkID8gdGhpcy5zZWxlY3RlZC5sZW5ndGggOiAwO1xuXG4gICAgY29uc3Qgc3VnZ2VzdGlvbkNvdW50ID0gc3VnZ2VzdGlvbnMubGVuZ3RoO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZWxlY3RlZENvdW50OyBpKyspIHtcbiAgICAgIGNvbnN0IHNlbGVjdGVkTGFiZWwgPSB0aGlzLmdldExhYmVsKFxuICAgICAgICB0aGlzLnNlbGVjdGVkW2ldXG4gICAgICApO1xuXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHN1Z2dlc3Rpb25Db3VudDsgaisrKSB7XG4gICAgICAgIGNvbnN0IHN1Z2dlc3RlZExhYmVsID0gdGhpcy5nZXRMYWJlbChcbiAgICAgICAgICBzdWdnZXN0aW9uc1tqXVxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChzZWxlY3RlZExhYmVsID09PSBzdWdnZXN0ZWRMYWJlbCkge1xuICAgICAgICAgIHN1Z2dlc3Rpb25zLnNwbGljZShqLCAxKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBzdWdnZXN0aW9ucztcbiAgfVxuXG4gIHB1YmxpYyByZW1vdmVFeGNsdWRlZChzdWdnZXN0aW9uczphbnlbXSk6YW55W10ge1xuICAgIGNvbnN0IGV4Y2x1ZGVkQ291bnQgPSB0aGlzLmV4Y2x1ZGUubGVuZ3RoO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBleGNsdWRlZENvdW50OyBpKyspIHtcbiAgICAgIGxldCBleGNsdWRlTGFiZWwgPSB0aGlzLmV4Y2x1ZGVbaV07XG4gICAgICBpZiAodHlwZW9mIGV4Y2x1ZGVMYWJlbCA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgZXhjbHVkZUxhYmVsID0gdGhpcy5nZXRMYWJlbChleGNsdWRlTGFiZWwpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBzdWdnZXN0aW9uQ291bnQgPSBzdWdnZXN0aW9ucy5sZW5ndGg7XG5cbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgc3VnZ2VzdGlvbkNvdW50OyBqKyspIHtcbiAgICAgICAgY29uc3Qgc3VnZ2VzdGVkTGFiZWwgPSB0aGlzLmdldExhYmVsKFxuICAgICAgICAgIHN1Z2dlc3Rpb25zW2pdXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKGV4Y2x1ZGVMYWJlbCA9PT0gc3VnZ2VzdGVkTGFiZWwpIHtcbiAgICAgICAgICBzdWdnZXN0aW9ucy5zcGxpY2UoaiwgMSk7XG5cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBzdWdnZXN0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgaXRlbSBmcm9tIHNlbGVjdGVkXG4gICAqXG4gICAqIEBwYXJhbSBzZWxlY3Rpb25cbiAgICogQHBhcmFtIG5vdGlmeT9cbiAgICovXG4gIHB1YmxpYyByZW1vdmVJdGVtKHNlbGVjdGlvbjphbnksIG5vdGlmeT86Ym9vbGVhbik6dm9pZCB7XG4gICAgY29uc3QgY291bnQgPSB0aGlzLnNlbGVjdGVkID8gdGhpcy5zZWxlY3RlZC5sZW5ndGggOiAwO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XG4gICAgICBjb25zdCBpdGVtID0gdGhpcy5zZWxlY3RlZFtpXTtcblxuICAgICAgY29uc3Qgc2VsZWN0ZWRMYWJlbCA9IHRoaXMuZ2V0TGFiZWwoc2VsZWN0aW9uKTtcbiAgICAgIGNvbnN0IGl0ZW1MYWJlbCA9IHRoaXMuZ2V0TGFiZWwoaXRlbSk7XG5cbiAgICAgIGlmIChzZWxlY3RlZExhYmVsID09PSBpdGVtTGFiZWwpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZC5zcGxpY2UoaSwgMSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgbm90aWZ5ID0gdHlwZW9mIG5vdGlmeSA9PT0gJ3VuZGVmaW5lZCcgPyB0cnVlIDogbm90aWZ5O1xuXG4gICAgaWYgKG5vdGlmeSkge1xuICAgICAgICB0aGlzLml0ZW1SZW1vdmVkLmVtaXQoc2VsZWN0aW9uKTtcbiAgICAgICAgdGhpcy5pdGVtc0NoYW5nZS5lbWl0KHRoaXMuc2VsZWN0ZWQpO1xuICAgIH1cblxuICAgIHRoaXMubW9kZWxDaGFuZ2UuZW1pdCh0aGlzLnNlbGVjdGVkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZWxlY3QgaXRlbSBmcm9tIGxpc3RcbiAgICpcbiAgICogQHBhcmFtIHNlbGVjdGlvblxuICAgKiovXG4gIHB1YmxpYyBzZWxlY3RJdGVtKHNlbGVjdGlvbjphbnkpOnZvaWQge1xuICAgIHRoaXMua2V5d29yZCA9IHRoaXMuZ2V0TGFiZWwoc2VsZWN0aW9uKTtcbiAgICB0aGlzLmZvcm1WYWx1ZSA9IHRoaXMuZ2V0Rm9ybVZhbHVlKHNlbGVjdGlvbik7XG4gICAgdGhpcy5oaWRlSXRlbUxpc3QoKTtcblxuICAgIHRoaXMudXBkYXRlTW9kZWwodGhpcy5mb3JtVmFsdWUpO1xuXG4gICAgaWYgKHRoaXMuaGlkZUxpc3RPblNlbGVjdGlvbikge1xuICAgICAgdGhpcy5oaWRlSXRlbUxpc3QoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5tdWx0aSkge1xuICAgICAgaWYgKHRoaXMubWF4U2VsZWN0ZWQgPT09IG51bGwgfHwgdGhpcy5zZWxlY3RlZC5sZW5ndGggPD0gdGhpcy5tYXhTZWxlY3RlZCkge1xuICAgICAgICB0aGlzLmNsZWFyVmFsdWUoKTtcblxuICAgICAgICB0aGlzLnNlbGVjdGVkLnB1c2goc2VsZWN0aW9uKTtcbiAgICAgICAgdGhpcy5pdGVtc0NoYW5nZS5lbWl0KHRoaXMuc2VsZWN0ZWQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNlbGVjdGlvbiA9IHNlbGVjdGlvbjtcblxuICAgICAgdGhpcy5zZWxlY3RlZCA9IFtzZWxlY3Rpb25dO1xuICAgICAgdGhpcy5pdGVtc0NoYW5nZS5lbWl0KHNlbGVjdGlvbik7XG4gICAgfVxuXG4gICAgdGhpcy5pdGVtU2VsZWN0ZWQuZW1pdChzZWxlY3Rpb24pO1xuICAgIHRoaXMubW9kZWxDaGFuZ2UuZW1pdCh0aGlzLnNlbGVjdGVkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgZm9jdXMgb2Ygc2VhcmNoYmFyXG4gICAqL1xuICBwdWJsaWMgc2V0Rm9jdXMoKTp2b2lkIHtcbiAgICBpZiAodGhpcy51c2VJb25JbnB1dCAmJiB0aGlzLmlucHV0RWxlbSkge1xuICAgICAgdGhpcy5pbnB1dEVsZW0ubmF0aXZlRWxlbWVudC5zZXRGb2N1cygpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5zZWFyY2hiYXJFbGVtKSB7XG4gICAgICB0aGlzLnNlYXJjaGJhckVsZW0ubmF0aXZlRWxlbWVudC5zZXRGb2N1cygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgc3VnZ2VzdGlvbnNcbiAgICpcbiAgICogQHBhcmFtIHN1Z2dlc3Rpb25zXG4gICAqIEBwYXJhbSBzaG93XG4gICAqL1xuICBwdWJsaWMgc2V0U3VnZ2VzdGlvbnMoc3VnZ2VzdGlvbnM6YW55W10sIHNob3c/OmJvb2xlYW4pOnZvaWQge1xuICAgIGlmICh0aGlzLnJlbW92ZUR1cGxpY2F0ZVN1Z2dlc3Rpb25zKSB7XG4gICAgICBzdWdnZXN0aW9ucyA9IHRoaXMucmVtb3ZlRHVwbGljYXRlcyhzdWdnZXN0aW9ucyk7XG4gICAgICBzdWdnZXN0aW9ucyA9IHRoaXMucmVtb3ZlRXhjbHVkZWQoc3VnZ2VzdGlvbnMpO1xuICAgIH1cblxuICAgIHRoaXMuc3VnZ2VzdGlvbnMgPSBzdWdnZXN0aW9ucztcblxuICAgIGlmIChzaG93IHx8IHR5cGVvZiBzaG93ID09PSAndW5kZWZpbmVkJykge1xuICAgICAgdGhpcy5zaG93SXRlbUxpc3QoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5hdXRvRm9jdXNTdWdnZXN0aW9uKSB7XG4gICAgICBpZiAodGhpcy5zdWdnZXN0aW9ucy5sZW5ndGggIT09IDApIHtcbiAgICAgICAgdGhpcy5mb2N1c2VkT3B0aW9uID0gMDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0IGN1cnJlbnQgaW5wdXQgdmFsdWVcbiAgICpcbiAgICogQHBhcmFtIHNlbGVjdGlvblxuICAgKi9cbiAgcHVibGljIHNldFZhbHVlKHNlbGVjdGlvbjogYW55KTp2b2lkIHtcbiAgICB0aGlzLmZvcm1WYWx1ZSA9IHRoaXMuZ2V0Rm9ybVZhbHVlKHNlbGVjdGlvbik7XG4gICAgdGhpcy5rZXl3b3JkID0gdGhpcy5nZXRMYWJlbChzZWxlY3Rpb24pO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaG93IGl0ZW0gbGlzdFxuICAgKi9cbiAgcHVibGljIHNob3dJdGVtTGlzdCgpOnZvaWQge1xuICAgIGlmICh0aGlzLnNob3dTdWdnZXN0aW9ucyA9PT0gZmFsc2UpIHtcbiAgICAgIHRoaXMuc2hvd0xpc3RDaGFuZ2VkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICB0aGlzLnNob3dTdWdnZXN0aW9ucyA9IHRydWU7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRoZSBtb2RlbFxuICAgKi9cbiAgcHVibGljIHVwZGF0ZU1vZGVsKGVudGVyZWRUZXh0OnN0cmluZyk6dm9pZCB7XG4gICAgaWYgKGVudGVyZWRUZXh0ICE9PSB0aGlzLmZvcm1WYWx1ZSkge1xuICAgICAgdGhpcy5mb3JtVmFsdWUgPSBlbnRlcmVkVGV4dDtcblxuICAgICAgaWYgKCF0aGlzLm11bHRpKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBudWxsO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLm9uQ2hhbmdlQ2FsbGJhY2spIHtcbiAgICAgIHRoaXMub25DaGFuZ2VDYWxsYmFjayh0aGlzLmZvcm1WYWx1ZSk7XG4gICAgfVxuXG4gICAgdGhpcy5tb2RlbENoYW5nZS5lbWl0KHRoaXMuc2VsZWN0ZWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFdyaXRlIHZhbHVlXG4gICAqXG4gICAqIEBwYXJhbSB2YWx1ZVxuICAgKi9cbiAgcHVibGljIHdyaXRlVmFsdWUodmFsdWU6YW55KTp2b2lkIHtcbiAgICBpZiAodmFsdWUgIT09IHRoaXMuc2VsZWN0aW9uKSB7XG4gICAgICB0aGlzLnNlbGVjdGlvbiA9IHZhbHVlIHx8IG51bGw7XG4gICAgICB0aGlzLmZvcm1WYWx1ZSA9IHRoaXMuZ2V0Rm9ybVZhbHVlKHRoaXMuc2VsZWN0aW9uKTtcbiAgICAgIHRoaXMua2V5d29yZCA9IHRoaXMuZ2V0TGFiZWwodGhpcy5zZWxlY3Rpb24pO1xuICAgIH1cbiAgfVxufVxuIl19